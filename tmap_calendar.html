<!doctype html>
<html lang="bg" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T-MAP ‚Äì –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞ –∫–∞—Ä—Ç–∞</title>
  <meta name="description" content="–ò–≥—Ä–∏–≤–∞ –∏ –∞–Ω–∏–º–∏—Ä–∞–Ω–∞ –Ω–∞—á–∞–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ T-MAP ‚Äì –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ –ë—ä–ª–≥–∞—Ä–∏—è. –ü–ª–∞–Ω–∏—Ä–∞–π, —Å–ø–æ–¥–µ–ª—è–π –∏ –æ—Ç–∫—Ä–∏–≤–∞–π!" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FAVICONS ‚Äî —Ç–≤–æ–∏—Ç–µ —Ñ–∞–π–ª–æ–≤–µ -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="favicon-64.png">
  <link rel="icon" type="image/png" sizes="512x512" href="favicon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <meta name="theme-color" content="#10b981">

  <style>
    /* -------------------- Base -------------------- */
    :root{ --brand1:#10b981; --brand2:#3b82f6; --brand3:#06b6d4; --ink:#0f172a }
    html,body{ height:100% }
    body{
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 120% -10%, rgba(16,185,129,.12), rgba(255,255,255,0)) no-repeat,
        radial-gradient(900px 500px at -10% 0%, rgba(59,130,246,.10), rgba(255,255,255,0)) no-repeat,
        linear-gradient(180deg,#ffffff 0%,#f9fafb 100%);
    }
    .glass{ backdrop-filter:saturate(180%) blur(10px) }
    .reveal{ opacity:0; transform:translateY(18px); transition:opacity .7s ease, transform .7s ease }
    .reveal.is-visible{ opacity:1; transform:translateY(0) }

    /* -------------------- Buttons -------------------- */
    @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .btn-cta{
      border-radius:16px; padding:.85rem 1.1rem; font-weight:800; color:#fff;
      background:linear-gradient(120deg,var(--brand1),var(--brand2),#22c55e,var(--brand3)); background-size:220% 220%;
      animation:gradientShift 8s ease infinite;
      box-shadow:0 10px 20px rgba(16,185,129,.25); transition:.15s ease; position:relative; overflow:hidden;
    }
    .btn-cta:hover{ transform:translateY(-2px); box-shadow:0 16px 28px rgba(16,185,129,.32) }
    .btn-ghost{ border-radius:14px; background:#fff; box-shadow:0 6px 16px rgba(0,0,0,.06); border:1px solid rgba(0,0,0,.05); transition:.15s ease }
    .btn-ghost:hover{ transform:translateY(-2px); box-shadow:0 12px 18px rgba(0,0,0,.08) }

    /* -------------------- Hero phone -------------------- */
    .phone-mask{
      -webkit-mask-image: radial-gradient(140% 140% at 50% 50%, #000 72%, rgba(0,0,0,0) 100%);
              mask-image: radial-gradient(140% 140% at 50% 50%, #000 72%, transparent 100%);
      -webkit-mask-repeat:no-repeat; mask-repeat:no-repeat;
    }
    .phone-wrap{ transform:rotate(10deg); will-change:transform;
      filter:drop-shadow(0 20px 34px rgba(16,185,129,.18)) drop-shadow(0 8px 14px rgba(59,130,246,.10)) }
    .phone-frame{ border-radius:24px; background:linear-gradient(180deg,#fff 0%,#f8fafc 100%); border:1px solid rgba(0,0,0,.06); padding:8px }
    @media (prefers-reduced-motion:no-preference){ .phone-wrap:hover{ transform: rotate(7deg) scale(1.01); transition:transform .35s ease } }

    /* -------------------- Mountains footer -------------------- */
    @keyframes drift{0%{transform:translateX(0)}100%{transform:translateX(-50px)}}
    .mountain-layer{ transform:translateZ(0) }
    .mountain-layer[data-slow]{ animation:drift 30s ease-in-out infinite alternate }
    .mountain-layer[data-fast]{ animation:drift 18s ease-in-out infinite alternate-reverse }

    /* -------------------- Floating particles -------------------- */
    #bg-canvas{ position:fixed; inset:0; z-index:-1; opacity:.35 }

    /* -------------------- Command palette -------------------- */
    .palette-enter{ opacity:0; transform:scale(.98); transition:.12s ease }
    .palette-enter.show{ opacity:1; transform:scale(1) }

    /* Tilt hover for cards */
    .hover-tilt{ transform-style:preserve-3d; perspective:800px }
    .hover-tilt > .tilt-item{ transition: transform .15s ease; transform: translateZ(0) }
  </style>
</head>
<body class="selection:bg-emerald-100/70">
  <canvas id="bg-canvas" aria-hidden="true"></canvas>

  <a href="#main" class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:z-50 bg-white text-gray-900 px-3 py-2 rounded-md shadow">–ö—ä–º —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ</a>

  <!-- Header -->
  <header class="fixed inset-x-0 top-0 z-50 border-b border-black/5 bg-white md:bg-white/80 md:backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-16 items-center justify-between">
        <a class="flex items-center gap-3" href="tmap.html" aria-label="T-MAP">
          <img src="https://turistibg.weebly.com/uploads/1/0/3/2/10320234/published/logo01082025-removebg-preview.png?1754135840" alt="T-MAP" class="h-8 w-auto" decoding="async"/>
          <span class="text-lg font-extrabold tracking-tight">T-MAP</span>
        </a>
        <div class="flex items-center gap-1">
          <button id="openPalette" class="hidden sm:inline-flex rounded-xl p-2 hover:bg-gray-100" title="–¢—ä—Ä—Å–∏ / Ctrl/Cmd+K" aria-label="–¢—ä—Ä—Å–∏">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          </button>
          <button id="menuBtn" class="rounded-xl p-2 hover:bg-gray-100" aria-label="–ú–µ–Ω—é" aria-expanded="false">
            <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Drawer -->
    <div id="overlay" class="fixed inset-0 bg-black/40 hidden"></div>
    <aside id="mobileDrawer" class="fixed top-0 right-0 h-full w-80 max-w-[85%] translate-x-full transition-transform duration-300 ease-out bg-white shadow-2xl border-l border-black/5 overflow-y-auto">
      <div class="flex items-center justify-between px-4 py-3 border-b border-black/5">
        <div class="flex items-center gap-2">
          <span class="font-semibold">–ú–µ–Ω—é</span>
        </div>
        <button id="closeDrawer" class="rounded-lg p-2 hover:bg-gray-100" aria-label="–ó–∞—Ç–≤–æ—Ä–∏ –º–µ–Ω—é">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
      </div>
      <nav class="px-3 py-4 space-y-1">
        <a href="tmap.html" class="block rounded-xl px-3 py-3 hover:bg-gray-50">–ö–∞—Ä—Ç–∞</a>
        <a href="https://turizam123.github.io/uzunov/dashboard.html" class="block rounded-xl px-3 py-3 hover:bg-gray-50" rel="noopener">–ú–æ–µ—Ç–æ —Ç–∞–±–ª–æ</a>
        <a href="https://turizam123.github.io/uzunov/docs/activate_gid.html" class="block rounded-xl px-3 py-3 hover:bg-gray-50" rel="noopener">–ê–∫—Ç–∏–≤–∏—Ä–∞–π –ì–ò–î</a>
        <a href="https://turizam123.github.io/uzunov/docs/join_gid.html" class="block rounded-xl px-3 py-3 hover:bg-gray-50" rel="noopener">–ü—Ä–∏—Å—ä–µ–¥–∏–Ω–∏ —Å–µ –∫—ä–º –ì–ò–î</a>
        <div class="pt-2">
          <p class="px-3 pb-1 text-xs uppercase tracking-wide text-gray-500">–ß–∞—Ç</p>
          <a href="https://turizam123.github.io/uzunov/tmap_chat.html" class="block rounded-xl px-3 py-3 hover:bg-gray-50">–û–±—â —á–∞—Ç</a>
          <a href="#" data-open-policy="chat_rules" class="block rounded-xl px-3 py-3 hover:bg-gray-50">–ü—Ä–∞–≤–∏–ª–∞ –Ω–∞ —á–∞—Ç–∞</a>
        </div>
        <div class="pt-4 flex gap-2">
          <a href="https://turizam123.github.io/uzunov/tmap_chat.html" class="flex-1 rounded-2xl border border-black/5 bg-white px-4 py-2 text-center text-sm font-semibold shadow-sm">–í–ª–µ–∑ –≤ —á–∞—Ç–∞</a>
          <a href="tmap.html" class="flex-1 rounded-2xl bg-emerald-600 px-4 py-2 text-center text-sm font-semibold text-white shadow-sm">–ö—ä–º –∫–∞—Ä—Ç–∞—Ç–∞</a>
        </div>
      </nav>
    </aside>
  </header>

  <main id="main" class="pt-24">
    <!-- HERO -->
    <section class="relative overflow-hidden">
      <div class="pointer-events-none absolute -top-20 -right-20 h-64 w-64 rounded-full bg-emerald-400/20 blur-3xl"></div>
      <div class="pointer-events-none absolute top-20 -left-12 h-72 w-72 rounded-full bg-sky-400/20 blur-3xl"></div>

      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="grid gap-10 lg:grid-cols-2 items-center py-12 lg:py-20">
          <div class="reveal">
            <p id="greet" class="text-sm font-semibold tracking-wide text-emerald-700"></p>
            <h1 class="mt-1 leading-none">
              <span class="block text-3xl sm:text-4xl lg:text-5xl font-extrabold tracking-tight text-slate-900">
                <span id="typewriter"></span>
              </span>
              <span class="hero-brand block mt-2 text-5xl sm:text-6xl lg:text-7xl font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-emerald-600 via-sky-600 to-emerald-500">
                T-MAP
              </span>
            </h1>

            <p class="mt-5 text-lg text-gray-700">
              –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞ –∫–∞—Ä—Ç–∞. –î–æ–±–∞–≤—è—à –ª–æ–∫–∞—Ü–∏–∏, –æ–±—â—É–≤–∞—à –≤ —á–∞—Ç, –∞ —Å–∫–æ—Ä–æ ‚Äì –æ—Ñ–ª–∞–π–Ω —Ç—Ä–∞–∫–∏–Ω–≥ (PWA).
            </p>

            <div class="mt-7 flex flex-wrap gap-3">
              <a href="tmap.html" class="btn-cta text-sm px-5 py-3">–í–∏–∂ –∫–∞—Ä—Ç–∞—Ç–∞</a>
              <a href="https://turizam123.github.io/uzunov/docs/bgx_multi.html" class="btn-ghost text-sm px-5 py-3" rel="noopener">–¢—Ä–µ–∫–∏–Ω–≥ –º–∞—Ä—à—Ä—É—Ç–∏</a>
              <a href="https://turizam123.github.io/uzunov/dashboard.html" class="btn-ghost text-sm px-5 py-3" rel="noopener">–î–æ–±–∞–≤–∏ –æ–±–µ–∫—Ç</a>
              <button id="installBtnTop" class="btn-ghost text-sm px-5 py-3 hidden">–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ</button>
            </div>

            <!-- Badges -->
            <div class="mt-6 flex flex-wrap items-center gap-3 text-sm text-gray-600">
              <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-2 shadow-sm ring-1 ring-black/5">
                <span class="h-2.5 w-2.5 rounded-full bg-emerald-500 animate-pulse"></span> –ù–æ–≤–∏ –æ–±–µ–∫—Ç–∏ –≤—Å–µ–∫–∏ –¥–µ–Ω
              </span>
              <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-2 shadow-sm ring-1 ring-black/5">
                <svg class="h-4 w-4 text-sky-600" viewBox="0 0 24 24" fill="none"><path d="M4 5h16v10H8l-4 4V5–∑" stroke="currentColor" stroke-width="1.5"/></svg> –û–±—â —á–∞—Ç –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ
              </span>
              <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-2 shadow-sm ring-1 ring-black/5">
                <svg class="h-4 w-4 text-amber-600" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M5 7h14M5 17h7" stroke="currentColor" stroke-width="1.5"/></svg> –õ–µ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
              </span>
            </div>
          </div>

          <!-- Right: tilted phone -->
          <div class="reveal">
            <div class="relative max-w-[220px] sm:max-w-[260px] lg:max-w-[300px] mx-auto hover-tilt" id="phoneTilt">
              <div class="absolute -inset-6 bg-gradient-to-br from-emerald-200/40 via-sky-200/35 to-emerald-100/40 blur-3xl rounded-[40px]"></div>
              <div class="relative phone-wrap tilt-item">
                <div class="phone-frame">
                  <img src="https://turistibg.weebly.com/uploads/1/0/3/2/10320234/529016311-1278612336749748-5228008378896628298-n_orig.jpg"
                       alt="T-MAP –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω ‚Äì –º–∞—Ä—à—Ä—É—Ç–∏ –∏ –∫–∞—Ä—Ç–∞"
                       class="w-full h-auto rounded-[20px] object-cover phone-mask"
                       loading="lazy" decoding="async"/>
                </div>
                <div class="pointer-events-none absolute inset-0 rounded-[24px]"><div class="absolute -top-8 -right-10 h-24 w-36 bg-white/30 blur-2xl rounded-full"></div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick gimmick cards -->
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 reveal">
          <a href="tmap.html" class="group rounded-2xl p-5 border border-black/5 bg-white shadow-sm hover:shadow-md transition hover-tilt">
            <div class="tilt-item">
              <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-xl bg-emerald-600/10 grid place-content-center">
                  <svg class="h-5 w-5 text-emerald-700 group-hover:animate-pulse" viewBox="0 0 24 24" fill="none"><path d="M12 22s8-7.2 8-13a8 8 0 10-16 0c0 5.8 8 13 8 13z" stroke="currentColor" stroke-width="1.5"/></svg>
                </div>
                <h3 class="font-semibold">–û—Ç–≤–æ—Ä–∏ T-MAP</h3>
              </div>
              <p class="mt-2 text-sm text-gray-600">–ó–∞–±–µ–ª–µ–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç–∏, –≤—ä—Ä—Ö–æ–≤–µ, –≤–æ–¥–æ–ø–∞–¥–∏ –∏ –æ—â–µ.</p>
            </div>
          </a>
          <a href="https://turizam123.github.io/uzunov/dashboard.html" class="group rounded-2xl p-5 border border-black/5 bg-white shadow-sm hover:shadow-md transition hover-tilt" rel="noopener">
            <div class="tilt-item">
              <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-xl bg-amber-500/10 grid place-content-center">
                  <svg class="—Ö-5 w-5 text-amber-600 group-hover:animate-bounce" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M5 7h14M5 17h7" stroke="currentColor" stroke-width="1.5"/></svg>
                </div>
                <h3 class="font-semibold">–î–æ–±–∞–≤–∏ –æ–±–µ–∫—Ç</h3>
              </div>
              <p class="mt-2 text-sm text-gray-600">–°–ø–æ–¥–µ–ª–∏ –ª—é–±–∏–º–æ –º—è—Å—Ç–æ ‚Äì –Ω–∏–µ —â–µ –≥–æ –æ–¥–æ–±—Ä–∏–º.</p>
            </div>
          </a>
          <button id="openInstall" class="group rounded-2xl p-5 border border-black/5 bg-white shadow-sm hover:shadow-md transition text-left hover-tilt">
            <div class="tilt-item">
              <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-xl bg-sky-500/10 grid place-content-center">
                  <svg class="h-5 w-5 text-sky-600" viewBox="0 0 24 24" fill="none">
                    <path d="M12 3v12m0 0l-4-4m4 4 4-4M4 21h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                </div>
                <h3 class="font-semibold">–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –∫–∞—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
              </div>
              <p class="mt-2 text-sm text-gray-600">–†–∞–±–æ—Ç–∏ –±—ä—Ä–∑–æ, –∏–º–∞ –æ—Ñ–ª–∞–π–Ω –∫–µ—à –∏ –∏–∫–æ–Ω–∞ –Ω–∞ –Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω.</p>
            </div>
          </button>
        </div>
      </div>
    </section>

    <!-- –°–ª–∞–π–¥–µ—Ä —Å—ä—Å —Å–Ω–∏–º–∫–∏ –æ—Ç –∫–∞—Ä—Ç–∞—Ç–∞ -->
    <section class="py-12 lg:py-16 reveal" id="tmap-photo-slider">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex items-end justify-between mb-4">
          <div>
            <h2 class="text-2xl lg:text-3xl font-extrabold">–°–Ω–∏–º–∫–∏ –æ—Ç T-MAP</h2>
            <p class="text-gray-600">–ü–ª—ä–∑–Ω–∏ ‚Äì –∏ —Å–µ –≤–¥—ä—Ö–Ω–æ–≤–∏ –∑–∞ —Å–ª–µ–¥–≤–∞—â–∞—Ç–∞ –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏—è.</p>
          </div>
          <div class="hidden md:flex items-center gap-2">
            <button type="button" id="pv-prev" class="rounded-xl border border-black/10 bg-white px-3 py-2 shadow-sm hover:shadow-md">‚Üê</button>
            <button type="button" id="pv-next" class="rounded-xl border border-black/10 bg-white px-3 py-2 shadow-sm hover:shadow-md">‚Üí</button>
          </div>
        </div>
        <div class="relative">
          <div class="pointer-events-none absolute inset-y-0 left-0 w-12 bg-gradient-to-r from-white to-transparent rounded-l-2xl"></div>
          <div class="pointer-events-none absolute inset-y-0 right-0 w-12 bg-gradient-to-l from-white to-transparent rounded-r-2xl"></div>
          <div id="pv-track" class="no-scrollbar snap-x snap-mandatory overflow-x-auto scroll-smooth flex gap-4 pb-2">
            <!-- —Å–∫–µ–ª–µ—Ç–æ–Ω–∏ -->
            <div class="shrink-0 w-72 sm:w-80 md:w-96 aspect-[4/3] rounded-2xl overflow-hidden bg-gray-100 ring-1 ring-black/5 animate-pulse"></div>
            <div class="shrink-0 w-72 sm:w-80 md:w-96 aspect-[4/3] rounded-2xl overflow-hidden bg-gray-100 ring-1 ring-black/5 animate-pulse"></div>
            <div class="shrink-0 w-72 sm:w-80 md:w-96 aspect-[4/3] rounded-2xl overflow-hidden bg-gray-100 ring-1 ring-black/5 animate-pulse"></div>
          </div>
        </div>
        <div class="mt-4 flex justify-end">
          <a href="tmap.html" class="btn-ghost px-4 py-2 text-sm font-semibold">–í–∏–∂ –≤—Å–∏—á–∫–∏ –≤ –∫–∞—Ä—Ç–∞—Ç–∞</a>
        </div>
      </div>
    </section>

    <!-- –î–æ–ª–µ–Ω —Å–µ–≥–º–µ–Ω—Ç —Å –ø–ª–∞–Ω–∏–Ω–∏ -->
    <section class="relative mt-10">
      <div class="absolute inset-x-0 bottom-0 h-[260px] overflow-hidden pointer-events-none -z-10">
        <svg class="absolute bottom-0 w-[200%] h-[180px] mountain-layer" data-slow viewBox="0 0 1440 320" preserveAspectRatio="none">
          <path fill="#e8f7f0" d="M0,192L48,202.7C96,213,192,235,288,240C384,245,480,235,576,208C672,181,768,139,864,138.7C960,139,1056,181,1152,197.3C1248,213,1344,203,1392,197.3L1440,192L1440,320L0,320Z"></path>
        </svg>
        <svg class="absolute bottom-0 w-[200%] h-[200px] mountain-layer" data-fast viewBox="0 0 1440 320" preserveAspectRatio="none">
          <path fill="#dff3ea" d="M0,256L60,256C120,256,240,256,360,240C480,224,600,192,720,197.3C840,203,960,245,1080,261.3C1200,277,1320,267,1380,261.3–õ1440,256L1440,320L0,320Z"></path>
        </svg>
        <svg class="absolute bottom-0 w-[200%] h-[220px] mountain-layer" viewBox="0 0 1440 320" preserveAspectRatio="none">
          <path fill="#cfeadf" d="M0,288L80,282.7C160,277,320,267,480,234.7C640,203,800,149,960,149.3C1120,149,1280,203,1360,229.3–õ1440,256L1440,320L0,320Z"></path>
        </svg>
      </div>

      <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="glass rounded-3xl border border-black/5 bg-white/70 shadow-xl p-6 md:p-8 mb-24 md:mb-0 relative z-10">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <p class="text-sm text-gray-700">¬© <span id="year"></span> T-MAP ‚Ä¢ –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞ –∫–∞—Ä—Ç–∞</p>
            <nav class="flex flex-wrap itemscenter gap-3 text-sm">
              <button type="button" data-open-policy="privacy" class="hover:underline">–ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞ –ø–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç</button>
              <button type="button" data-open-policy="terms" class="hover:underline">–£—Å–ª–æ–≤–∏—è –∑–∞ –ø–æ–ª–∑–≤–∞–Ω–µ</button>
              <button type="button" data-open-policy="cookies" class="hover:underline">–ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞ –±–∏—Å–∫–≤–∏—Ç–∫–∏</button>
              <button type="button" data-open-policy="chat_rules" class="hover:underline">–ü—Ä–∞–≤–∏–ª–∞ –Ω–∞ —á–∞—Ç–∞</button>
              <span class="hidden sm:inline-block h-5 w-px bg-gray-300"></span>
              <a href="https://turistibg.weebly.com" target="_blank" rel="noopener" class="hover:underline">–û—Å–Ω–æ–≤–µ–Ω —Å–∞–π—Ç</a>
              <a href="https://www.facebook.com/turizamworld?locale=bg_BG" target="_blank" rel="noopener" aria-label="Facebook" class="inline-flex items-center gap-1 hover:underline">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M22 12.06C22 6.53 17.52 2 12 2S2 6.53 2 12.06c0 4.99 3.66 9.13 8.44 9.94v-7.03H7.9v-2.9h2.54V9.41c0-2.5 1.49-3.88 3.77-3.88 1.09 0 2.24.2 2.24.2v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.44 2.9h-2.34V22c4.78-.81 8.44-4.95 8.44-9.94z"/></svg>
              </a>
            </nav>
          </div>
        </div>
        <div class="h-[240px]"></div>
      </div>
    </section>
  </main>

  <!-- Sticky –º–æ–±–∏–ª–µ–Ω –±–∞—Ä -->
  <div class="md:hidden fixed inset-x-3 bottom-3 z-50">
  <div class="glass bg-white/90 border border-black/5 shadow-xl rounded-2xl p-2 flex gap-2">
    <a href="tmap.html" class="flex-1 btn-ghost px-4 py-3 text-sm text-center font-semibold">–ö–∞—Ä—Ç–∞</a>
    <a href="https://turizam123.github.io/uzunov/docs/bgx_multi.html" class="flex-1 btn-cta px-4 py-3 text-sm text-center" rel="noopener">–¢—Ä–µ–∫–∏–Ω–≥</a>
    <a href="https://turizam123.github.io/uzunov/tmap_chat.html" class="flex-1 btn-ghost px-4 py-3 text-sm text-center font-semibold" rel="noopener">–ß–∞—Ç</a>
    </div>
  </div>

  <!-- Command palette -->
  <div id="paletteOverlay" class="fixed inset-0 bg-black/50 hidden z-[60]"></div>
  <section id="palette" class="palette-enter hidden fixed inset-x-4 top-10 md:inset-x-auto md:right-6 md:left-auto max-w-2xl md:w-[640px] rounded-2xl bg-white shadow-2xl ring-1 ring-black/10 z-[61]">
    <div class="border-b border-gray-200 px-4 py-3 flex items-center gap-2">
      <svg class="h-5 w-5 text-gray-500" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      <input id="paletteInput" class="w-full outline-none" placeholder="–¢—ä—Ä—Å–∏: –ö–∞—Ä—Ç–∞, –ß–∞—Ç, –î–æ–±–∞–≤–∏, –ü—Ä–∞–≤–∏–ª–∞‚Ä¶" />
      <kbd class="hidden md:inline text-xs text-gray-500">Esc</kbd>
    </div>
    <ul id="paletteList" class="max-h-[60vh] overflow-y-auto p-2">
      <li class="px-3 py-2 rounded-lg hover:bg-gray-50 cursor-pointer" data-href="tmap.html">üîé –û—Ç–≤–æ—Ä–∏ –∫–∞—Ä—Ç–∞—Ç–∞</li>
      <li class="px-3 py-2 rounded-lg hover:bg-gray-50 cursor-pointer" data-href="https://turizam123.github.io/uzunov/tmap_chat.html">üí¨ –û–±—â —á–∞—Ç</li>
      <li class="px-3 py-2 rounded-lg hover:bg-gray-50 cursor-pointer" data-href="https://turizam123.github.io/uzunov/tmap_calendar.html">üóìÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä</li>
      <li class="px-3 py-2 rounded-lg hover:bg-gray-50 cursor-pointer" data-href="https://turizam123.github.io/uzunov/dashboard.html">‚ûï –î–æ–±–∞–≤–∏ –æ–±–µ–∫—Ç</li>
      <li class="px-3 py-2 rounded-lg hover:bg-gray-50 cursor-pointer" data-policy="chat_rules">üìú –ü—Ä–∞–≤–∏–ª–∞ –Ω–∞ —á–∞—Ç–∞</li>
    </ul>
  </section>

  <!-- Bottom-sheet Install -->
  <div id="installSheet" class="hidden fixed inset-x-0 bottom-0 z-[55]">
    <div class="mx-auto max-w-2xl px-4 pb-4">
      <div class="glass bg-white/90 border border-black/5 shadow-2xl rounded-2xl p-4">
        <div class="flex items-start gap-3">
          <div class="h-10 w-10 rounded-xl bg-emerald-600/10 grid place-content-center">
            <svg class="h-6 w-6 text-emerald-600" viewBox="0 0 24 24" fill="none"><path d="M12 3v12m0 0l-4-4m4 4 4-4M4 21h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          </div>
          <div class="flex-1">
            <h3 class="font-semibold">–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π T-MAP</h3>
            <p class="text-sm text-gray-600">–ü–æ-–±—ä—Ä–∑ –¥–æ—Å—Ç—ä–ø –∏ –æ—Ñ–ª–∞–π–Ω –∫–µ—à. –©–µ –¥–æ–±–∞–≤–∏–º –∏ –∏–∫–æ–Ω–∞ –Ω–∞ –Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω.</p>
            <div class="mt-3 flex gap-2">
              <button id="installNow" class="btn-cta px-4 py-2 text-sm">–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π</button>
              <button id="installClose" class="btn-ghost px-4 py-2 text-sm">–ü–æ-–∫—ä—Å–Ω–æ</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Policy modal -->
  <div id="policy-overlay" class="fixed inset-0 bg-black/50 hidden z-50"></div>
  <section id="policy-modal" class="fixed inset-x-4 top-10 md:inset-x-auto md:right-6 md:left-auto z-50 hidden max-w-2xl md:w-[640px] rounded-2xl bg-white shadow-2xl ring-1 ring-black/10 overflow-hidden">
    <header class="flex items-center justify-between px-5 py-3 border-b border-gray-200">
      <h2 id="policy-title" class="text-base font-semibold">–ü–æ–ª–∏—Ç–∏–∫–∏</h2>
      <button type="button" id="policy-close" class="rounded-lg p-2 hover:bg-gray-50" aria-label="–ó–∞—Ç–≤–æ—Ä–∏">
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </header>
    <article id="policy-content" class="px-5 py-4 max-h-[70vh] overflow-y-auto text-sm leading-6 text-gray-700 space-y-3"></article>
    <footer class="px-5 py-3 border-t border-gray-200 text-right">
      <button type="button" id="policy-ok" class="btn-cta text-sm px-4 py-2">–û–ö</button>
    
<!-- === –ù–∞—á–∞–ª–Ω–∞ —Å–µ–∫—Ü–∏—è: –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏ —Å—ä–±–∏—Ç–∏—è (–∫–∞—Ä—Ç–∏) === -->
<section class="py-10 lg:py-12 reveal" id="tmap-events-cards">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex items-end justify-between mb-3">
      <div>
        <h2 class="text-2xl lg:text-3xl font-extrabold">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏ —Å—ä–±–∏—Ç–∏—è</h2>
        <p class="text-gray-600">–ü–ª—ä–∑–Ω–∏ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–æ, –∑–∞ –¥–∞ —Ä–∞–∑–≥–ª–µ–¥–∞—à.</p>
      </div>
      <div class="hidden md:flex items-center gap-2">
        <button type="button" id="ev-prev" class="rounded-xl border border-black/10 bg-white px-3 py-2 shadow-sm hover:shadow-md">‚Üê</button>
        <button type="button" id="ev-next" class="rounded-xl border border-black/10 bg-white px-3 py-2 shadow-sm hover:shadow-md">‚Üí</button>
      </div>
    </div>
    <div id="eventsByYear" class="space-y-8"></div>
  </div>
  <style>
    #tmap-events-cards .track{ overflow-x:auto; scroll-snap-type:x mandatory; scroll-behavior:smooth; display:flex; gap:14px; padding-bottom:6px; }
    #tmap-events-cards .track::-webkit-scrollbar{ height:0 }
    #tmap-events-cards .track{ scrollbar-width:none; -ms-overflow-style:none }
    #tmap-events-cards .card{
      flex:0 0 auto; width: clamp(240px, 26vw, 340px);
      background:#fff; border-radius:18px; box-shadow:0 10px 24px rgba(0,0,0,.10); border:1px solid rgba(0,0,0,.06);
      overflow:hidden; scroll-snap-align:start; transition:.12s ease transform, .12s ease box-shadow;
    }
    #tmap-events-cards .card:hover{ transform:translateY(-2px); box-shadow:0 14px 30px rgba(0,0,0,.16) }
    #tmap-events-cards .thumb{ position:relative; aspect-ratio:16/10; background:#eef2f7; }
    #tmap-events-cards .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
    #tmap-events-cards .date-pill{
      position:absolute; top:10px; left:10px; background:#fff; color:#0f172a; font-weight:800;
      padding:6px 12px; border-radius:999px; box-shadow:0 6px 18px rgba(0,0,0,.15); font-size:13px;
    }
    #tmap-events-cards .title{ padding:12px 14px 14px; font-weight:900; font-size:clamp(16px,2vw,18px) }
  </style>
</section>
</footer>
  </section>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // ---------- Helpers ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => [...document.querySelectorAll(sel)];
    $('#year').textContent = new Date().getFullYear();

    // Greeting
    (function greet(){
      const h = new Date().getHours();
      const t = h<11 ? '–î–æ–±—Ä–æ —É—Ç—Ä–æ!' : h<18 ? '–•–µ–π, –ø—Ä–∏—è—Ç–Ω–æ —Å–ª–µ–¥–æ–±–µ–Ω–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!' : '–í–µ—á–µ—Ä–Ω–∞ —Ä–∞–∑—Ö–æ–¥–∫–∞?';
      const el = document.getElementById('greet'); el.textContent = t;
    })();

    // Typewriter
    (function typewriter(){
      const messages = ['–û—Ç–∫—Ä–∏–π –ë—ä–ª–≥–∞—Ä–∏—è —Å', '–ü–ª–∞–Ω–∏—Ä–∞–π. –°–ø–æ–¥–µ–ª—è–π. –û—Ç–∫—Ä–∏–≤–∞–π —Å', '–ì–æ—Ç–æ–≤ –ª–∏ —Å–∏ –∑–∞ —Å–ª–µ–¥–≤–∞—â–∏—è –≤—Ä—ä—Ö —Å'];
      let i=0, j=0, dir=1, hold=0;
      const el = document.getElementById('typewriter');
      function tick(){
        const m = messages[i];
        j += dir;
        el.textContent = m.slice(0, j) + (j<m.length ? '|' : '');
        if (j===m.length){ hold++; if(hold>10){ dir=-1; hold=0; } }
        if (j===0 && dir===-1){ dir=1; i=(i+1)%messages.length; }
        requestAnimationFrame(tick);
      }
      tick();
    })();

    // Reveal on view
    const io=new IntersectionObserver(es=>es.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('is-visible'); }),{threshold:.12});
    $$('.reveal').forEach(el=>io.observe(el));

    // Drawer
    const menuBtn = $('#menuBtn'), overlay = $('#overlay'), drawer = $('#mobileDrawer'), closeDrawer = $('#closeDrawer');
    function openDrawer(){ overlay.classList.remove('hidden'); requestAnimationFrame(()=>drawer.classList.remove('translate-x-full')); menuBtn.setAttribute('aria-expanded','true'); document.documentElement.classList.add('overflow-hidden'); document.body.classList.add('overflow-hidden'); }
    function hideDrawer(){ drawer.classList.add('translate-x-full'); overlay.classList.add('hidden'); menuBtn.setAttribute('aria-expanded','false'); document.documentElement.classList.remove('overflow-hidden'); document.body.classList.remove('overflow-hidden'); }
    menuBtn.addEventListener('click', openDrawer); overlay.addEventListener('click', hideDrawer); closeDrawer.addEventListener('click', hideDrawer); document.addEventListener('keydown', e=>{ if(e.key==='Escape') hideDrawer(); });

    // Policy modal content
    const policyOverlay=$('#policy-overlay'), policyModal=$('#policy-modal'), policyTitle=$('#policy-title'), policyContent=$('#policy-content');
    const policyClose=$('#policy-close'), policyOk=$('#policy-ok');
    const POLICY_TEXT={
      privacy:{title:'–ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞ –ø–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç',html:`<p>–ù–∏–µ —É–≤–∞–∂–∞–≤–∞–º–µ –ª–∏—á–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏ –Ω–∞ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏—Ç–µ. –°—ä–±–∏—Ä–∞–º–µ –º–∏–Ω–∏–º–∞–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∑–∞ —Ä–∞–±–æ—Ç–∞—Ç–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞ T-MAP, –∫–∞—Ç–æ –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ª–æ–≥–æ–≤–µ (IP, user-agent) –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.</p>
          <p>–î–∞–Ω–Ω–∏, –∫–æ–∏—Ç–æ –¥–æ–±—Ä–æ–≤–æ–ª–Ω–æ –Ω–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è—Ç–µ (–Ω–∞–ø—Ä. –∑–∞–≥–ª–∞–≤–∏–µ/–æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –æ–±–µ–∫—Ç, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏) —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç —Å–∞–º–æ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞ –∏ –º–æ–¥–µ—Ä–∏—Ä–∞–Ω–µ. –ù–µ –ø—Ä–æ–¥–∞–≤–∞–º–µ –∏ –Ω–µ —Å–ø–æ–¥–µ–ª—è–º–µ –¥–∞–Ω–Ω–∏ —Å —Ç—Ä–µ—Ç–∏ —Å—Ç—Ä–∞–Ω–∏ –∏–∑–≤—ä–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏—Ç–µ –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏ (–Ω–∞–ø—Ä. —Ö–æ—Å—Ç–∏–Ω–≥/Supabase) —Å—ä–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏.</p><p>–ú–æ–∂–µ—Ç–µ –¥–∞ –ø–æ–∏—Å–∫–∞—Ç–µ –ø—Ä–µ–≥–ª–µ–¥/–∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω–∏ —á—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Äa.</p>`},
      terms:{title:'–£—Å–ª–æ–≤–∏—è –∑–∞ –ø–æ–ª–∑–≤–∞–Ω–µ',html:`<p>–ò–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ —Å–∞–π—Ç–∞, —Å–µ —Å—ä–≥–ª–∞—Å—è–≤–∞—Ç–µ –¥–∞ –ø—É–±–ª–∏–∫—É–≤–∞—Ç–µ —Å–∞–º–æ –≤—è—Ä–Ω–æ –∏ –∑–∞–∫–æ–Ω–æ—Å—ä–æ–±—Ä–∞–∑–Ω–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ, –¥–∞ —É–≤–∞–∂–∞–≤–∞—Ç–µ –∞–≤—Ç–æ—Ä—Å–∫–∏ –ø—Ä–∞–≤–∞ –∏ –ª–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏.</p><p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ä—Ç –º–æ–∂–µ –¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞/–ø—Ä–µ–º–∞—Ö–≤–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –∏ –¥–∞ –æ–≥—Ä–∞–Ω–∏—á–∞–≤–∞ –¥–æ—Å—Ç—ä–ø –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è. –£—Å–ª—É–≥–∞—Ç–∞ —Å–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è "–∫–∞–∫—Ç–æ –µ" –±–µ–∑ –≥–∞—Ä–∞–Ω—Ü–∏–∏ –∑–∞ –Ω–µ–ø—Ä–µ–∫—ä—Å–Ω–∞—Ç–æ—Å—Ç.</p><p>–î–æ–±–∞–≤–µ–Ω–∏—Ç–µ –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –æ–±–µ–∫—Ç–∏ —Å–µ –ø—É–±–ª–∏–∫—É–≤–∞—Ç —Å–ª–µ–¥ –æ–¥–æ–±—Ä–µ–Ω–∏–µ..</p>`},
      cookies:{title:'–ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞ –±–∏—Å–∫–≤–∏—Ç–∫–∏',html:`<p>–ò–∑–ø–æ–ª–∑–≤–∞–º–µ –æ—Å–Ω–æ–≤–Ω–∏ –±–∏—Å–∫–≤–∏—Ç–∫–∏ –∑–∞ –∑–∞–ø–æ–º–Ω—è–Ω–µ –Ω–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è (–Ω–∞–ø—Ä. –≤–∏–¥–µ–Ω–∏ –æ–±–µ–∫—Ç–∏) –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏/—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∏ –±–∏—Å–∫–≤–∏—Ç–∫–∏ –∑–∞ –ø–æ–¥–æ–±—Ä—è–≤–∞–Ω–µ –Ω–∞ —É—Å–ª—É–≥–∞—Ç–∞.</p><p>–ú–æ–∂–µ—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ –∏–ª–∏ –±–ª–æ–∫–∏—Ä–∞—Ç–µ –±–∏—Å–∫–≤–∏—Ç–∫–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ —Å–∏. –ù—è–∫–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–µ –¥–∞ –Ω–µ —Ä–∞–±–æ—Ç—è—Ç –æ–ø—Ç–∏–º–∞–ª–Ω–æ –±–µ–∑ –±–∏—Å–∫–≤–∏—Ç–∫–∏.</p>`},
      chat_rules: {
        title: '–ü—Ä–∞–≤–∏–ª–∞ –Ω–∞ —á–∞—Ç–∞',
        html: `
          <h3 class="font-semibold">1) –£–≤–∞–∂–µ–Ω–∏–µ –∏ —Ç–æ–Ω</h3>
          <ul class="list-disc pl-5">
            <li>–ë–µ–∑ –æ–±–∏–¥–∏, —Ä–µ—á –Ω–∞ –æ–º—Ä–∞–∑–∞, –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è –∏–ª–∏ —Ç–æ–∫—Å–∏—á–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.</li>
            <li>–ë–µ–∑ —Å–ø–∞–º –∏ –∞–≥—Ä–µ—Å–∏–≤–Ω–∞ —Ä–µ–∫–ª–∞–º–∞. –ü–∞—Ä—Ç–Ω—å–æ—Ä—Å–∫–∏/—Ç—ä—Ä–≥–æ–≤—Å–∫–∏ –ª–∏–Ω–∫–æ–≤–µ ‚Äì —Å–∞–º–æ —Å–ª–µ–¥ –æ–¥–æ–±—Ä–µ–Ω–∏–µ.</li>
          </ul>
          <h3 class="font-semibold mt-3">2) –ü–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç</h3>
          <ul class="list-disc pl-5">
            <li>–ù–µ –ø—É–±–ª–∏–∫—É–≤–∞–π –ª–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏ (—Ç–µ–ª–µ—Ñ–æ–Ω–∏, –∏–º–µ–π–ª–∏, –∞–¥—Ä–µ—Å–∏) –±–µ–∑ —Å—ä–≥–ª–∞—Å–∏–µ.</li>
            <li>–ù–µ —Å–ø–æ–¥–µ–ª—è–π —Ç–æ—á–Ω–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–∞ —á–∞—Å—Ç–Ω–∏ –¥–æ–º–æ–≤–µ/–∏–º–æ—Ç–∏. –ó–∞ –∑–∞—â–∏—Ç–µ–Ω–∏ —Ç–µ—Ä–∏—Ç–æ—Ä–∏–∏ ‚Äì —Å–ª–µ–¥–≤–∞–π –º–µ—Å—Ç–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞.</li>
            <li>–°–Ω–∏–º–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏ —Ö–æ—Ä–∞ ‚Äì —Å–∞–º–æ –∞–∫–æ –∏–º–∞—à –ø—Ä–∞–≤–æ –¥–∞ –≥–∏ —Å–ø–æ–¥–µ–ª–∏—à.</li>
          </ul>
          <h3 class="font-semibold mt-3">3) –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –∏ —Ç–µ–º–∞</h3>
          <ul class="list-disc pl-5">
            <li>–û—Å—Ç–∞–Ω–∏ –ø–æ —Ç–µ–º–∞—Ç–∞: —Ç—É—Ä–∏–∑—ä–º, –º–∞—Ä—à—Ä—É—Ç–∏, –æ–±–µ–∫—Ç–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç, –µ–∫–∏–ø–∏—Ä–æ–≤–∫–∞.</li>
            <li>–§–∞–ª—à–∏–≤–∞/–ø–æ–¥–≤–µ–∂–¥–∞—â–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –æ–ø–∞—Å–Ω–∏ —Å—ä–≤–µ—Ç–∏ —Å–∞ –∑–∞–±—Ä–∞–Ω–µ–Ω–∏.</li>
            <li>NSFW/–Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –Ω–µ –µ –ø–æ–∑–≤–æ–ª–µ–Ω–æ.</li>
          </ul>
          <h3 class="font-semibold mt-3">4) –ú–æ–¥–µ—Ä–∞—Ü–∏—è</h3>
          <ul class="list-disc pl-5">
            <li>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä–∏—Ç–µ –º–æ–≥–∞—Ç –¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç/–∏–∑—Ç—Ä–∏–≤–∞—Ç —Å—ä–æ–±—â–µ–Ω–∏—è –∏ –¥–∞ –æ–≥—Ä–∞–Ω–∏—á–∞–≤–∞—Ç –¥–æ—Å—Ç—ä–ø –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è.</li>
            <li>–°—Ç—ä–ø–∫–∏: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ‚Üí –ø–æ—Å—Ç–æ—è–Ω–Ω–∞ –∑–∞–±—Ä–∞–Ω–∞ (–ø—Ä–∏ —Å–µ—Ä–∏–æ–∑–Ω–∏/–ø–æ–≤—Ç–∞—Ä—è—â–∏ —Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è).</li>
          </ul>
          <h3 class="font-semibold mt-3">5) –°—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è</h3>
          <ul class="list-disc pl-5">
            <li>–ß–∞—Ç—ä—Ç –µ –∫—Ä–∞—Ç–∫–æ–∂–∏–≤–µ–µ—â: —Å—ä–æ–±—â–µ–Ω–∏—è—Ç–∞ —Å–µ –∏–∑—á–∏—Å—Ç–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (–≤ –º–æ–º–µ–Ω—Ç–∞: –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª–Ω–æ –¥–æ 1 —á–∞—Å).</li>
            <li>–ê—Ä—Ö–∏–≤ –Ω–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞, –æ—Å–≤–µ–Ω –º–∏–Ω–∏–º–∞–ª–Ω–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ª–æ–≥–æ–≤–µ –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç.</li>
          </ul>
          <h3 class="font-semibold mt-3">6) –°–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ</h3>
          <ul class="list-disc pl-5">
            <li>–°–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–∞–π –ø—Ä–æ–±–ª–µ–º–Ω–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –Ω–∞: <a class="underline" href="mailto:82angeluzunov@gmail.com">82angeluzunov@gmail.com</a>.</li>
          </ul>
          <p class="text-sm text-gray-600 mt-3">–ü—Ä–∏ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ —á–∞—Ç–∞ –ø—Ä–∏–µ–º–∞—à —Ç–µ–∑–∏ –ø—Ä–∞–≤–∏–ª–∞. –ú–æ–∂–µ –¥–∞ –±—ä–¥–∞—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –ø—Ä–∏ –Ω—É–∂–¥–∞.</p>
        `
      }
    };
    function openPolicy(key){ const p=POLICY_TEXT[key]; if(!p) return; policyTitle.textContent=p.title; policyContent.innerHTML=p.html; policyOverlay.classList.remove('hidden'); policyModal.classList.remove('hidden'); }
    function closePolicy(){ policyOverlay.classList.add('hidden'); policyModal.classList.add('hidden'); }
    $$('[data-open-policy]').forEach(btn=>btn.addEventListener('click', ()=>{ try{ hideDrawer(); }catch(_){} openPolicy(btn.getAttribute('data-open-policy')); }));
    policyOverlay.addEventListener('click', closePolicy); policyClose.addEventListener('click', closePolicy); policyOk.addEventListener('click', closePolicy);

    // Command palette
    const palO = $('#paletteOverlay'), pal = $('#palette'), palInput = $('#paletteInput'), palList = $('#paletteList'), palBtn = $('#openPalette');
    function openPal(){ palO.classList.remove('hidden'); pal.classList.remove('hidden'); requestAnimationFrame(()=>pal.classList.add('show')); palInput.focus(); }
    function closePal(){ pal.classList.remove('show'); palO.classList.add('hidden'); pal.classList.add('hidden'); }
    palBtn.addEventListener('click', openPal);
    palO.addEventListener('click', closePal);
    document.addEventListener('keydown', e=>{ if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); openPal(); } if(e.key==='Escape'){ closePal(); } });
    palInput.addEventListener('input', ()=>{ const q=palInput.value.toLowerCase(); $$('#paletteList li').forEach(li=>{ li.style.display = li.textContent.toLowerCase().includes(q)?'block':'none'; }); });
    $$('#paletteList li').forEach(li=>li.addEventListener('click', ()=>{ if(li.dataset.href) location.href=li.dataset.href; if(li.dataset.policy) openPolicy(li.dataset.policy); closePal(); }));

    // 3D tilt for cards & phone
    function attachTilt(root){
      const item=root.querySelector('.tilt-item'); if(!item) return;
      function move(e){
        const r=root.getBoundingClientRect();
        const x=(e.clientX - r.left)/r.width, y=(e.clientY - r.top)/r.height;
        const rx=(.5-y)*10, ry=(x-.5)*12;
        item.style.transform=`rotateX(${rx}deg) rotateY(${ry}deg) translateZ(10px)`;
      }
      function leave(){ item.style.transform='rotateX(0) rotateY(0) translateZ(0)' }
      root.addEventListener('pointermove', move); root.addEventListener('pointerleave', leave);
    }
    attachTilt(document.getElementById('phoneTilt'));
    $$('.hover-tilt').forEach(attachTilt);

    // Floating particles canvas (disabled if reduced motion)
    (function particles(){
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const c = document.getElementById('bg-canvas'); const ctx = c.getContext('2d',{alpha:true});
      let w= c.width = innerWidth, h = c.height = innerHeight;
      const dots = Array.from({length: 70}, ()=>({x: Math.random()*w, y: Math.random()*h, r: Math.random()*2+0.4, vx:(Math.random()-.5)*.25, vy:(Math.random()-.5)*.25}));
      function draw(){
        ctx.clearRect(0,0,w,h);
        for(const d of dots){
          d.x+=d.vx; d.y+=d.vy;
          if(d.x<0||d.x>w) d.vx*=-1; if(d.y<0||d.y>h) d.vy*=-1;
          ctx.beginPath(); ctx.arc(d.x,d.y,d.r,0,Math.PI*2);
          ctx.fillStyle='rgba(16,185,129,.55)'; ctx.fill();
        }
        requestAnimationFrame(draw);
      }
      draw();
      addEventListener('resize', ()=>{ w=c.width=innerWidth; h=c.height=innerHeight; });
    })();

    // PWA install prompt
    let deferredPrompt=null;
    const sheet = $('#installSheet'), installTop = $('#installBtnTop'), openInstall = $('#openInstall');
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt = e;
      sheet.classList.remove('hidden'); installTop.classList.remove('hidden');
    });
    $('#installNow').addEventListener('click', async ()=>{
      if(!deferredPrompt){ sheet.classList.add('hidden'); return }
      deferredPrompt.prompt(); const { outcome } = await deferredPrompt.userChoice; sheet.classList.add('hidden');
      if(outcome==='accepted'){ confetti() }
      deferredPrompt=null;
    });
    $('#installClose').addEventListener('click', ()=>sheet.classList.add('hidden'));
    openInstall.addEventListener('click', ()=> sheet.classList.remove('hidden'));

    // Minimal confetti
    function confetti(){
      const el=document.createElement('div'); el.style.cssText='position:fixed;inset:0;pointer-events:none;z-index:70';
      document.body.appendChild(el);
      const colors=['#10b981','#3b82f6','#22c55e','#06b6d4','#f59e0b'];
      const N=120;
      for(let i=0;i<N;i++){
        const s=document.createElement('i');
        const size=Math.random()*8+4;
        s.style.cssText=`position:absolute;left:${Math.random()*100}%;top:-10px;width:${size}px;height:${size}px;background:${colors[i%colors.length]};transform:rotate(${Math.random()*360}deg);opacity:.9;border-radius:1px`;
        el.appendChild(s);
        const endY=innerHeight+40;
        s.animate([{ transform:`translateY(0) rotate(0)` },{ transform:`translateY(${endY}px) rotate(${Math.random()*720}deg)` }], { duration: 1200+Math.random()*900, easing:'cubic-bezier(.2,.6,.2,1)', fill:'forwards' })
          .onfinish = ()=> s.remove();
      }
      setTimeout(()=>el.remove(), 2500);
    }

    // Photo slider from Supabase
    (async function initPhotoSlider(){
      const client = supabase.createClient(
        'https://cmiylzpmpwqbacjoqtkx.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtaXlsenBtcHdxYmFjam9xdGt4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5ODcwMDUsImV4cCI6MjA2OTU2MzAwNX0.FY2d1NSGTmw6SydxT_V0cKF7Kp2USbp91VdfO_eqZz8'
      );
      const track=$('#pv-track'), btnPrev=$('#pv-prev'), btnNext=$('#pv-next');

      let rows=[]; try{
        const { data, error } = await client
          .from('objects')
          .select('id,title,image_url,created_at')
          .not('image_url','is', null)
          .order('created_at', { ascending:false })
          .limit(15);
        if(error) throw error; rows=data||[];
      }catch(e){ console.warn('slider fetch error:', e); rows=[]; }

      if(rows.length===0){
        track.innerHTML=`<div class="shrink-0 w-full md:w-auto grow rounded-2xl border border-dashed border-emerald-400/60 bg-emerald-50 p-6 text-emerald-700">–ù—è–º–∞ —Å–Ω–∏–º–∫–∏. <a href="https://turizam123.github.io/uzunov/dashboard.html" class="underline font-semibold" rel="noopener">–î–æ–±–∞–≤–∏ –ø—ä—Ä–≤–∏—è —Å–∏ –æ–±–µ–∫—Ç</a>.</div>`;
        return;
      }

      track.innerHTML = rows.map(r=>{
        const url='tmap.html?focus='+encodeURIComponent(r.id);
        const created=new Date(r.created_at);
        const fresh=(Date.now()-created.getTime())/(1000*60*60*24)<=7;
        const title=(r.title||'–û–±–µ–∫—Ç').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        return `<a href="${url}" class="group relative shrink-0 w-72 sm:w-80 md:w-96 aspect-[4/3] rounded-2xl overflow-hidden bg-gray-100 ring-1 ring-black/5 snap-start hover-tilt">
          <img src="${r.image_url}" alt="${title}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.03]" loading="lazy" decoding="async"/>
          <div class="absolute inset-0 tilt-item"></div>
          <div class="absolute inset-0" style="background: linear-gradient(180deg, rgba(0,0,0,0) 40%, rgba(0,0,0,.65) 100%)"></div>
          <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
            <div class="flex items-center gap-2">
              <h3 class="line-clamp-1 font-semibold text-base">${title}</h3>
              ${fresh?'<span class="text-[11px] px-2 py-0.5 rounded-full bg-emerald-500/90">–Ω–æ–≤</span>':''}
            </div>
            <p class="text-white/80 text-xs">–û—Ç–≤–æ—Ä–∏ –≤ –∫–∞—Ä—Ç–∞—Ç–∞ ‚Üí</p>
          </div>
        </a>`;
      }).join('');
      $$('#pv-track .hover-tilt').forEach(attachTilt);

      const getStep=()=>{ const card=track.querySelector('a'); if(!card) return 320; const gap=parseInt(getComputedStyle(track).gap||'16',10); return card.getBoundingClientRect().width+gap; };
      btnPrev?.addEventListener('click',()=>track.scrollBy({left:-getStep(),behavior:'smooth'}));
      btnNext?.addEventListener('click',()=>track.scrollBy({left:getStep(),behavior:'smooth'}));

      let auto=null;
      function start(){ if(matchMedia('(prefers-reduced-motion: reduce)').matches) return; stop(); auto=setInterval(()=>{ const max=track.scrollWidth-track.clientWidth-4; const step=getStep(); if(track.scrollLeft+step>=max){ track.scrollTo({left:0,behavior:'smooth'}); } else { track.scrollBy({left:step,behavior:'smooth'}); } }, 4200); }
      function stop(){ if(auto){ clearInterval(auto); auto=null; } }
      track.addEventListener('mouseenter', stop); track.addEventListener('mouseleave', start);
      track.addEventListener('touchstart', stop, {passive:true}); track.addEventListener('touchend', start, {passive:true}); start();
    })();
  </script>

  <!-- ========= Safety Coach ‚Äì Compact Airy (–≤–≥—Ä–∞–¥–µ–Ω –±–µ–∑ –ø—Ä–æ–º–µ–Ω–∏ –ø–æ –æ—Å—Ç–∞–Ω–∞–ª–æ—Ç–æ) ========= -->
  <style>
    @keyframes scx-pop { 0%{transform:translateY(10px) scale(.98);opacity:0} 100%{transform:none;opacity:1} }
    .scx-card{ animation:scx-pop .25s ease forwards }
    .scx-dot{ width:6px; height:6px; border-radius:999px; background:#cbd5e1 }
    .scx-dot.is-active{ background:linear-gradient(90deg,#10b981,#3b82f6) }
  </style>

  <div id="scx"
       class="hidden fixed z-[70] right-4 bottom-24 sm:bottom-6 w-[92vw] max-w-[340px]">
    <div role="dialog" aria-labelledby="scx-title" aria-modal="true"
         class="relative scx-card rounded-2xl bg-white/80 backdrop-blur-xl ring-1 ring-black/10
                shadow-[0_12px_30px_rgba(2,6,23,.12)] overflow-hidden">
      <div class="pointer-events-none absolute -top-8 -left-8 h-24 w-24 rounded-full
                  bg-gradient-to-br from-emerald-300/40 via-sky-300/30 to-transparent blur-2xl"></div>

      <div class="p-3.5">
        <div class="flex items-start gap-3">
          <div class="h-9 w-9 rounded-xl grid place-content-center bg-emerald-600/10 ring-1 ring-emerald-600/20">
            <svg class="h-5 w-5 text-emerald-700" viewBox="0 0 24 24" fill="none">
              <path d="M12 22s8-7.2 8-13a8 8 0 10-16 0c0 5.8 8 13 8 13z" stroke="currentColor" stroke-width="1.5"/>
            </svg>
          </div>
          <div class="min-w-0 flex-1">
            <h3 id="scx-title" class="text-base font-semibold leading-tight">–°—Ç—è–≥–∞—à –ª–∏ —Å–µ –∑–∞ –ø—Ä–µ—Ö–æ–¥?</h3>
            <p id="scx-body" class="mt-0.5 text-xs text-slate-600">–ë—ä—Ä–∑ —á–µ–∫–ª–∏—Å—Ç –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç.</p>
          </div>
          <button id="scx-close" class="shrink-0 rounded-lg p-1.5 hover:bg-slate-100" aria-label="–ó–∞—Ç–≤–æ—Ä–∏">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
        </div>

        <div class="mt-3 flex gap-2">
          <button id="scx-yes"
                  class="flex-1 inline-flex justify-center items-center rounded-xl px-3 py-2 text-white text-sm font-semibold
                         bg-gradient-to-r from-emerald-600 via-sky-600 to-emerald-500 shadow">
            –î–∞
          </button>
          <button id="scx-no"
                  class="flex-1 inline-flex justify-center items-center rounded-xl px-3 py-2 text-sm font-semibold
                         bg-white ring-1 ring-black/10 shadow-sm">
            –ù–µ
          </button>
        </div>

        <div class="mt-2 flex items-center justify-between">
          <div id="scx-dots" class="flex gap-1.5"><i class="scx-dot is-active"></i><i class="scx-dot"></i><i class="scx-dot"></i><i class="scx-dot"></i></div>
          <button id="scx-hide" class="text-[11px] text-slate-500 underline">–ù–µ –ø–æ–∫–∞–∑–≤–∞–π 7 –¥–Ω–∏</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  (() => {
    const $ = s => document.querySelector(s);
    const coach = $('#scx');
    const title = $('#scx-title'), body = $('#scx-body');
    const yesBtn = $('#scx-yes'), noBtn = $('#scx-no');
    const dotsWrap = $('#scx-dots');
    const closeBtn=$('#scx-close'), hideBtn=$('#scx-hide');

    const KEY='tmap_sc_hide_until';
    const until = +localStorage.getItem(KEY) || 0;
    if (Date.now() < until) return;

    const END = {
      browse:{ t:'–ü—Ä–∏—è—Ç–Ω–æ —Å—ä—Ä—Ñ–∏—Ä–∞–Ω–µ!', b:'–†–∞–∑–≥–ª–µ–∂–¥–∞–π T-MAP –∏ —Ç—Ä–µ–∫–∏–Ω–≥ –º–∞—Ä—à—Ä—É—Ç–∏—Ç–µ.', btns:[
        {label:'–ö–∞—Ä—Ç–∞', href:'tmap.html', primary:true},
        {label:'–¢—Ä–µ–∫–∏–Ω–≥', href:'https://turizam123.github.io/uzunov/docs/bgx_multi.html'}
      ]},
      gear:{ t:'–ü–æ–¥–≥–æ—Ç–≤–∏ –µ–∫–∏–ø–∏—Ä–æ–≤–∫–∞—Ç–∞', b:'–û–±—É–≤–∫–∏ –∑–∞ —Å–µ–∑–æ–Ω–∞, –¥—ä–∂–¥–æ–±—Ä–∞–Ω, —á–µ–ª–Ω–∏–∫, —â–µ–∫–∏.', btns:[{label:'–û–ö', close:true}]},
      insurance:{ t:'–ü–ª–∞–Ω–∏–Ω—Å–∫–∞ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞', b:'–ü—Ä–µ–ø–æ—Ä—ä—á–≤–∞–º –¥–∞ —Å–∏ –Ω–∞–ø—Ä–∞–≤–∏—à –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–µ–¥–∏ —Ç—Ä—ä–≥–≤–∞–Ω–µ.', btns:[{label:'–†–∞–∑–±—Ä–∞—Ö', close:true}]},
      pack:{ t:'–î–æ–ø—ä–ª–Ω–∏ —Ä–∞–Ω–∏—Ü–∞—Ç–∞', b:'–í–æ–¥–∞, —Ö—Ä–∞–Ω–∞/—Å–ª–∞–¥–∫–æ, –∞–ø—Ç–µ—á–∫–∞, –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∏.', btns:[{label:'–û–ö', close:true}]},
      ready:{ t:'–ü–æ–∂–µ–ª–∞–≤–∞–º –ø—Ä–∏—è—Ç–µ–Ω –ø—Ä–µ—Ö–æ–¥!', b:'–ü–æ—Å–ª–µ —Å–ø–æ–¥–µ–ª–∏ ‚Äì –¥–æ–±–∞–≤–∏ –æ–±–µ–∫—Ç –≤ T-MAP.', btns:[
        {label:'–î–æ–±–∞–≤–∏ –æ–±–µ–∫—Ç', href:'https://turizam123.github.io/uzunov/dashboard.html', primary:true},
        {label:'–¢—Ä–µ–∫–∏–Ω–≥', href: 'https://turizam123.github.io/uzunov/docs/bgx_multi.html'}
      ], confetti:true }
    };

    const steps = [
      {id:'go',    q:'–•–µ–π, —Å—Ç—è–≥–∞—à –ª–∏ —Å–µ –∑–∞ –ø—Ä–µ—Ö–æ–¥?', yes:'equip', no:'browse'},
      {id:'equip', q:'–ï–∫–∏–ø–∏—Ä–æ–≤–∫–∞—Ç–∞ —Å–µ–∑–æ–Ω–Ω–∞ –ª–∏ –µ?',     yes:'ins',   no:'gear'},
      {id:'ins',   q:'–ò–º–∞—à –ª–∏ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞?',       yes:'check',  no:'insurance'},
 // different id to avoid name clash with END.pack
      {id:'pack',  q:'–í–æ–¥–∞, —Ö—Ä–∞–Ω–∞, –∞–ø—Ç–µ—á–∫–∞?',   yes:'ready', no:'pack'}
    ];
    let i=0;

    const show = () => { coach.classList.remove('hidden'); render(); };
    const hide = () => coach.classList.add('hidden');

    function setDots(idx){
      [...dotsWrap.children].forEach((d, n)=> d.classList.toggle('is-active', n===idx));
    }

    function render(){
      const s=steps[i];
      title.textContent=s.q;
      body.textContent='–ë—ä—Ä–∑ —á–µ–∫–ª–∏—Å—Ç –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç.';
      yesBtn.classList.remove('hidden'); noBtn.classList.remove('hidden');
      const old = coach.querySelector('#scx-end'); if(old) old.remove();
      setDots(i);
    }

    function renderEnd(key){
      const e = END[key] || END.browse;
      title.textContent=e.t; body.textContent=e.b;
      yesBtn.classList.add('hidden'); noBtn.classList.add('hidden');
      const wrap=document.createElement('div'); wrap.id='scx-end'; wrap.className='mt-2 flex gap-2';
      wrap.innerHTML = e.btns.map(b =>
        b.href
          ? `<a href="${b.href}" class="flex-1 inline-flex justify-center items-center rounded-xl px-3 py-2 text-sm font-semibold ${b.primary?'text-white bg-gradient-to-r from-emerald-600 via-sky-600 to-emerald-500 shadow':'bg-white ring-1 ring-black/10 shadow-sm'}">${b.label}</a>`
          : `<button data-close class="flex-1 inline-flex justify-center items-center rounded-xl px-3 py-2 text-sm font-semibold bg-white ring-1 ring-black/10 shadow-sm">${b.label}</button>`
      ).join('');
      yesBtn.parentElement.after(wrap);
      wrap.querySelectorAll('[data-close]').forEach(b=>b.addEventListener('click', hide, {once:true}));
      setDots(steps.length-1);
      if(e.confetti) confetti();
    }

    yesBtn.addEventListener('click', () => {
      const s=steps[i];
      if (s.yes in END) return renderEnd(s.yes);
      i=Math.min(i+1,steps.length-1); render();
    });
    noBtn.addEventListener('click', () => {
      const s=steps[i];
      if (s.no in END) return renderEnd(s.no);
      const next = steps.findIndex(x=>x.id===s.no);
      if(next>=0){ i=next; render(); }
    });

    closeBtn.addEventListener('click', hide);
    hideBtn.addEventListener('click', () => {
      const sevenDays=7*24*60*60*1000;
      localStorage.setItem(KEY, String(Date.now()+sevenDays));
      hide();
    });

    setTimeout(show, 900);

    function confetti(){
      const el=document.createElement('div'); el.style.cssText='position:fixed;inset:0;pointer-events:none;z-index:80';
      document.body.appendChild(el);
      const colors=['#10b981','#3b82f6','#22c55e','#06b6d4','#f59e0b'];
      for(let k=0;k<70;k++){
        const s=document.createElement('i'); const size=Math.random()*7+3;
        s.style.cssText=`position:absolute;left:${Math.random()*100}%;top:-10px;width:${size}px;height:${size}px;background:${colors[k%colors.length]};opacity:.9;border-radius:1px`;
        el.appendChild(s);
        const endY=innerHeight+40;
        s.animate([{transform:'translateY(0) rotate(0)'},{transform:`translateY(${endY}px) rotate(${Math.random()*540}deg)`}],{duration:1100+Math.random()*800,easing:'cubic-bezier(.2,.6,.2,1)',fill:'forwards'}).onfinish=()=>s.remove();
      }
      setTimeout(()=>el.remove(), 2200);
    }
  })();
  </script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
(() => {
  const CALENDAR_URL = 'tmap_calendar (5).html';
  const SUPABASE_URL = 'https://cmiylzpmpwqbacjoqtkx.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtaXlsenBtcHdxYmFjam9xdGt4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5ODcwMDUsImV4cCI6MjA2OTU2MzAwNX0.FY2d1NSGTmw6SydxT_V0cKF7Kp2USbp91VdfO_eqZz8';
  const TABLE = 'tmap_calendar_events';

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  const pad = n => String(n).padStart(2,'0');
  const iso = d => [d.getFullYear(), pad(d.getMonth()+1), pad(d.getDate())].join('-');
  const fmt = s => { const [Y,M,D]=s.split('-'); return `${D}.${M}.${Y}`; };
  const todayIso = iso(new Date());
  const firstDate = ev => ev.dates?.[0] || null;
  const lastDate  = ev => ev.dates?.[ev.dates.length-1] || null;

  async function fetchEvents(){
    const { data, error } = await sb.from(TABLE).select('*').order('created_at', { ascending: true });
    if(error){ console.warn(error); return []; }
    return (data||[]).map(r => ({
      id: r.id, title: r.title, image: r.image || '', url: r.url || '', color: r.color || null,
      dates: (r.dates || []).map(String)
    }));
  }

  function groupByYear(list){
    const map = new Map();
    list.forEach(ev => {
      const d = firstDate(ev); const year = d ? d.slice(0,4) : '–ë–µ–∑ –¥–∞—Ç–∞';
      if(!map.has(year)) map.set(year, []); map.get(year).push(ev);
    });
    return map;
  }

  function buildCard(ev){
    const a = document.createElement('a');
    const from = firstDate(ev), to = lastDate(ev) || from;
    const url = new URL(CALENDAR_URL, location.href);
    if(from) url.searchParams.set('from', from);
    if(to)   url.searchParams.set('to', to);
    if(ev.id) url.searchParams.set('focus', ev.id);
    a.href = url.pathname + url.search + url.hash;
    a.className = 'card';
    a.innerHTML = `
      <div class="thumb">
        ${ev.image ? `<img src="${ev.image}" alt="${ev.title}">` : ''}
        ${from ? `<div class="date-pill">${fmt(from)}${to && to!==from ? `‚Äì${fmt(to)}` : ''}</div>` : ''}
      </div>
      <h3 class="title">${ev.title || '–°—ä–±–∏—Ç–∏–µ'}</h3>
    `;
    return a;
  }

  function renderByYear(container, grouped){
    container.innerHTML = '';
    const years = Array.from(grouped.keys()).sort((a,b)=>a.localeCompare(b));
    years.forEach(year => {
      const wrap = document.createElement('div');
      wrap.innerHTML = `
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-sm uppercase tracking-widest text-gray-500">–ì–æ–¥–∏–Ω–∞ ${year}</h3>
        </div>
        <div class="relative">
          <div class="pointer-events-none absolute inset-y-0 left-0 w-10 bg-gradient-to-r from-white to-transparent rounded-l-2xl"></div>
          <div class="pointer-events-none absolute inset-y-0 right-0 w-10 bg-gradient-to-l from-white to-transparent rounded-r-2xl"></div>
          <div class="track" data-year="${year}"></div>
        </div>
      `;
      const track = wrap.querySelector('.track');
      const list = grouped.get(year).slice().sort((a,b)=>(firstDate(a)||'').localeCompare(firstDate(b)||''));
      list.forEach(ev => track.appendChild(buildCard(ev)));
      container.appendChild(wrap);
    });
    const prev = document.getElementById('ev-prev');
    const next = document.getElementById('ev-next');
    function scrollBy(dx){ container.querySelectorAll('.track').forEach(t => t.scrollBy({ left: dx, behavior:'smooth' })); }
    prev?.addEventListener('click', ()=>scrollBy(-360));
    next?.addEventListener('click', ()=>scrollBy(+360));
  }

  async function init(){
    const target = document.getElementById('eventsByYear');
    if(!target) return;
    const all = await fetchEvents();
    const upcoming = all.filter(ev => { const d = lastDate(ev) || firstDate(ev); return d && d >= iso(new Date()); });
    if(upcoming.length === 0){ target.innerHTML = `<p class="text-gray-600">–ù—è–º–∞ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏ —Å—ä–±–∏—Ç–∏—è.</p>`; return; }
    renderByYear(target, groupByYear(upcoming));
  }
  document.addEventListener('DOMContentLoaded', init);
})();
</script>

</body>
</html>
