<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#16a34a">
  <title>Заявка – Програма за Планински водачи</title>
  <meta name="description" content="Подай заявка за обучение за планински водачи: онлайн теория, теренни модули, оцеляване и първа помощ, бивакуване, алпинизъм, въжета и Виа Ферата, организиране на преходи." />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />

  <style>
    :root{
      --brand:#16a34a; --brand-2:#22c55e; --ring:#16a34a;
      --ink:#0f172a; --muted:#64748b;
    }
    html,body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
    html{scroll-behavior:smooth}

    /* Cards */
    .card{position:relative;border-radius:1rem;border:1px solid rgb(226 232 240);background:#fff;
      box-shadow:0 8px 30px rgba(2,6,23,.06);transition:transform .18s ease, box-shadow .18s ease, border-color .2s;}
    .card:hover{transform:translateY(-2px);box-shadow:0 18px 40px rgba(2,6,23,.09);border-color:rgba(34,197,94,.35)}
    .card-head{display:flex;align-items:flex-start;justify-content:space-between;padding:1.1rem 1.25rem;
      background:linear-gradient(90deg,#f0fdf4,#dcfce7)}
    .card-title{font-size:1.1rem;font-weight:800;letter-spacing:-.01em;color:var(--ink)}
    .card-body{padding:1.1rem 1.25rem;font-size:.94rem;color:#334155}
    .card-foot{padding:.75rem 1.25rem 1.1rem;display:flex;align-items:center;justify-content:space-between}

    /* Chips & Buttons */
    .chip{display:inline-flex;align-items:center;border-radius:999px;border:1px solid rgb(226 232 240);
      padding:.2rem .6rem;font-size:.69rem;font-weight:700}
    .chip-green{border-color:#bbf7d0;color:#166534;background:#f0fdf4}
    .chip-red{border-color:#fecaca;color:#991b1b;background:#fef2f2}
    .chip-amber{border-color:#fde68a;color:#92400e;background:#fffbeb}
    .chip-blue{border-color:#bfdbfe;color:#1d4ed8;background:#eff6ff}
    .btn{position:relative;display:inline-flex;align-items:center;justify-content:center;border-radius:.9rem;
      padding:.55rem 1rem;font-weight:700;border:1px solid rgb(226 232 240);background:#fff;color:#334155;
      transition:transform .08s, box-shadow .2s}
    .btn:focus-visible{outline:3px solid var(--ring);outline-offset:3px}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;border-color:transparent;box-shadow:0 8px 20px rgba(34,197,94,.25)}
    .btn-primary:hover{box-shadow:0 12px 26px rgba(34,197,94,.35)}
    .tap-area{gap:.5rem;padding:.375rem .5rem;border-radius:.75rem}

    /* Animated header background */
    .hero-wrap{position:relative;overflow:hidden}
    .bg-wave{position:absolute;inset:0;z-index:-1;opacity:.35}
    .blob{position:absolute;filter:blur(60px);opacity:.35;animation:float 16s ease-in-out infinite}
    .blob-1{background:radial-gradient(circle at 30% 30%, #86efac, transparent 60%);width:40rem;height:40rem;left:-10%;top:-10%}
    .blob-2{background:radial-gradient(circle at 70% 40%, #a7f3d0, transparent 60%);width:32rem;height:32rem;right:-5%;top:-5%;animation-delay:3s}
    .blob-3{background:radial-gradient(circle at 50% 70%, #bbf7d0, transparent 60%);width:36rem;height:36rem;left:10%;bottom:-10%;animation-delay:6s}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(14px)}}

    .price-xl{font-size:1.35rem;font-weight:800}
    .muted{font-size:.83rem;color:var(--muted)}
    .safe-bottom{padding-bottom:max(env(safe-area-inset-bottom),1rem)}
    .tap-card{cursor:pointer}
    .tap-card:hover .tap-hint{opacity:1;transform:translateY(0)}
    .tap-hint{opacity:0;transform:translateY(4px);transition:all .2s}

    /* Modal scroll invisible */
    .scroll-y-invisible{overflow-y:auto;-ms-overflow-style:none;scrollbar-width:none}
    .scroll-y-invisible::-webkit-scrollbar{display:none}

    /* Toast */
    .toast{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%) translateY(20px);
      background:#111827;color:#fff;border-radius:14px;padding:.8rem 1rem;box-shadow:0 14px 40px rgba(0,0,0,.25);
      display:flex;align-items:center;gap:.6rem;z-index:70;opacity:0;pointer-events:none;transition:all .25s}
    .toast--show{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:auto}
    .toast--success{background:#065f46}
    .toast--warn{background:#92400e}
    .toast--error{background:#7f1d1d}

    /* Progress bar in summary */
    .progress{height:8px;border-radius:999px;background:#f1f5f9;overflow:hidden}
    .progress > span{display:block;height:100%;background:linear-gradient(90deg,#34d399,#22c55e);width:0%;transition:width .35s ease}

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{transition:none !important;animation-duration:.001ms !important;animation-iteration-count:1 !important}
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- HERO -->
  <header class="hero-wrap relative">
    <div class="bg-wave" aria-hidden="true">
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>
      <div class="blob blob-3"></div>
      <svg viewBox="0 0 1440 320" class="w-full h-[140px] md:h-[180px] opacity-40">
        <path fill="#16a34a" d="M0,224L48,229.3C96,235,192,245,288,229.3C384,213,480,171,576,170.7C672,171,768,213,864,229.3C960,245,1056,235,1152,197.3C1248,160,1344,96,1392,64L1440,32L1440,0L0,0Z"></path>
      </svg>
    </div>

    <div class="max-w-7xl mx-auto px-4 pt-10 pb-6 sm:pt-12 sm:pb-8">
      <div class="text-center">
        <a href="https://turizam123.github.io/uzunov/tmap_home.html" class="inline-flex items-center gap-3 justify-center">
          <span class="chip chip-green">Обучителен център „Туристически свят“</span>
        </a>

        <h1 class="mt-3 text-3xl sm:text-5xl font-extrabold tracking-tight">
          Заявка за включване – <span class="text-green-700">Планински водачи</span>
        </h1>
        <p class="mt-3 text-slate-600 max-w-3xl mx-auto">
          Избери онлайн и теренни модули. Задължителни: „Онлайн теория“, „Оцеляване &amp; Медицински ситуации“,
          <strong>+ избор</strong> „Лято“ или „Зима“, и „Организиране на мероприятия“.
        </p>

        <!-- Превключване на валута -->
        <div class="mt-6 inline-flex items-center gap-2 rounded-full border bg-white/90 backdrop-blur px-2 py-2 shadow-sm" role="group" aria-label="Превключване на валута">
          <span class="text-xs uppercase tracking-wider text-slate-500 pl-2">Валута</span>
          <button id="btnBGN" class="btn px-3 py-1 rounded-full bg-green-600 text-white" aria-pressed="true" type="button">BGN</button>
          <button id="btnEUR" class="btn px-3 py-1 rounded-full text-green-700 hover:bg-green-50" aria-pressed="false" type="button">EUR</button>
          <span class="text-[11px] text-slate-500 pr-2" aria-hidden="true">1 EUR = 1.95583 BGN</span>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 pb-28 lg:pb-24">
    <div class="grid lg:grid-cols-3 gap-6 lg:gap-8">
      <!-- LEFT: PROGRAMS -->
      <section class="lg:col-span-2">
        <h2 class="text-2xl font-bold">Модули</h2>

        <div class="mt-5 grid sm:grid-cols-2 gap-5" id="modulesGrid">

          <!-- Sample module cards (не пипам логиката/цените) -->
          <article class="card tap-card">
            <div class="card-head">
              <h3 class="card-title">ОНЛАЙН ОБУЧЕНИЕ – ТЕОРИЯ</h3>
              <div class="flex gap-1">
                <span class="chip chip-green">онлайн</span>
                <span class="chip chip-red">задължителен</span>
              </div>
            </div>
            <div class="card-body">
              <p>Интензивна теоретична подготовка: <strong>6 дни × 4 часа</strong>. Теоретичен изпит след всеки модул.</p>
              <p class="tap-hint mt-2 text-xs text-green-700">включен по подразбиране</p>
            </div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="180">180 BGN</span></div>
                <div class="muted">еднократно</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-not-allowed select-none">
                <input type="checkbox" class="module cb mandatory accent-green-600 scale-125" data-name="ОНЛАЙН ОБУЧЕНИЕ – ТЕОРИЯ" data-bgn="180" checked disabled>
                <span class="text-sm font-medium opacity-60">Включен</span>
              </label>
            </div>
          </article>

          <article class="card tap-card">
            <div class="card-head">
              <h3 class="card-title">ОЦЕЛЯВАНЕ / МЕДИЦИНСКИ СИТУАЦИИ</h3>
              <div class="flex gap-1">
                <span class="chip chip-amber">терен</span>
                <span class="chip chip-blue">онлайн</span>
                <span class="chip chip-red">задължителен</span>
              </div>
            </div>
            <div class="card-body">
              <ul class="list-disc pl-5 space-y-1">
                <li><strong>Теория:</strong> 2 дни × 4 часа онлайн</li>
                <li><strong>Практика:</strong> изпит на терен – извеждане на контузен; оказване на първа помощ</li>
                <li>Оценка на риска, евакуация, бивак</li>
              </ul>
            </div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="320">320 BGN</span></div>
                <div class="muted">комбиниран модул</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-not-allowed select-none">
                <input type="checkbox" class="module cb mandatory need-insurance accent-green-600 scale-125" data-name="ОЦЕЛЯВАНЕ / МЕДИЦИНСКИ СИТУАЦИИ" data-bgn="320" checked disabled>
                <span class="text-sm font-medium opacity-60">Включен</span>
              </label>
            </div>
          </article>

          <article class="card tap-card">
            <div class="card-head">
              <h3 class="card-title">ОРИЕНТИРАНЕ (компас, карта, GPS)</h3>
              <div class="flex gap-1">
                <span class="chip chip-blue">теория</span>
                <span class="chip chip-amber">терен</span>
                <span class="chip chip-red">задължителен</span>
              </div>
            </div>
            <div class="card-body">
              <ul class="list-disc pl-5 space-y-1">
                <li><strong>Теория:</strong> 2 дни × 6 часа – компас, карта, GPS; <em>изпит без поправка</em>.</li>
                <li><strong>Терен:</strong> 3 дни – водене в реална среда; <em>изпит в реална среда</em>.</li>
              </ul>
            </div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="290">290 BGN</span></div>
                <div class="muted">комбиниран модул</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-not-allowed select-none">
                <input type="checkbox" class="module cb mandatory need-insurance accent-green-600 scale-125" data-name="ОРИЕНТИРАНЕ" data-bgn="290" checked disabled>
                <span class="text-sm font-medium opacity-60">Включен</span>
              </label>
            </div>
          </article>

          <!-- SUMMER -->
          <article class="card tap-card" data-toggle-card>
            <div class="card-head">
              <h3 class="card-title">НА ТЕРЕН – ЛЯТО</h3>
              <div class="flex gap-1">
                <span class="chip chip-amber">терен</span>
                <span class="chip chip-red">избери</span>
              </div>
            </div>
            <div class="card-body">
              Реална среда: ориентиране, карта/компас, водене на група.
              <div class="tap-hint text-xs text-slate-500 mt-2">натисни картата, за да (де)активираш</div>
            </div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="290">290 BGN</span></div>
                <div class="muted">двудневен модул</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-pointer select-none">
                <input type="checkbox" class="module cb need-insurance required-season accent-green-600 scale-125"
                       data-group="season" data-name="НА ТЕРЕН – ЛЯТО" data-bgn="290">
                <span class="text-sm font-medium">Избирам</span>
              </label>
            </div>
          </article>

          <!-- WINTER -->
          <article class="card tap-card" data-toggle-card>
            <div class="card-head">
              <h3 class="card-title">НА ТЕРЕН – ЗИМА</h3>
              <div class="flex gap-1">
                <span class="chip chip-amber">терен</span>
                <span class="chip chip-red">избери</span>
              </div>
            </div>
            <div class="card-body">Лавинна безопасност, зимна екипировка и техники за придвижване.</div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="340">340 BGN</span></div>
                <div class="muted">двудневен модул</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-pointer select-none">
                <input type="checkbox" class="module cb need-insurance required-season accent-green-600 scale-125"
                       data-group="season" data-name="НА ТЕРЕН – ЗИМА" data-bgn="340">
                <span class="text-sm font-medium">Избирам</span>
              </label>
            </div>
          </article>

          <!-- WEATHER -->
          <article class="card tap-card" data-toggle-card>
            <div class="card-head">
              <h3 class="card-title">ВРЕМЕ / МЕТЕОРОЛОГИЯ</h3>
              <div class="flex gap-1"><span class="chip chip-blue">теория</span></div>
            </div>
            <div class="card-body">
              <ul class="list-disc pl-5 space-y-1">
                <li><strong>Теория:</strong> 1 ден × 6 часа – фронтове, облаци, валежи, вятър.</li>
                <li><strong>Изпит:</strong> финален тест по темите от модула.</li>
              </ul>
            </div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="270">270 BGN</span></div>
                <div class="muted">теория + изпит</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-pointer select-none">
                <input type="checkbox" class="module cb accent-green-600 scale-125"
                       data-name="ВРЕМЕ / МЕТЕОРОЛОГИЯ" data-bgn="270">
                <span class="text-sm font-medium">Избирам</span>
              </label>
            </div>
          </article>

          <!-- BIVOUACKING -->
          <article class="card tap-card" data-toggle-card>
            <div class="card-head">
              <h3 class="card-title">БИВАКУВАНЕ</h3>
              <span class="chip chip-blue">теория</span>
              <span class="chip chip-amber">терен</span>
            </div>
            <div class="card-body">Изграждане на бивак, избор на място, Leave No Trace, нощни рискове.</div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="200">200 BGN</span></div>
                <div class="muted">двудневен / нощен модул - (8ч.)</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-pointer select-none">
                <input type="checkbox" class="module cb need-insurance accent-green-600 scale-125"
                       data-name="БИВАКУВАНЕ" data-bgn="200">
                <span class="text-sm font-medium">Избирам</span>
              </label>
            </div>
          </article>

          <!-- ALPINISM -->
          <article class="card tap-card" data-toggle-card>
            <div class="card-head">
              <h3 class="card-title">АЛПИНИЗЪМ – ТЕОРИЯ</h3>
              <span class="chip chip-blue">теория</span>
              <span class="chip chip-amber">терен</span>
            </div>
            <div class="card-body">Теоретични основи, възли, техники, планиране и безопасност.</div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="320">320 BGN</span></div>
                <div class="muted">тридневнен модул (12 ч)</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-pointer select-none">
                <input type="checkbox" class="module cb accent-green-600 scale-125" data-name="АЛПИНИЗЪМ – ТЕОРИЯ" data-bgn="320">
                <span class="text-sm font-medium">Избирам</span>
              </label>
            </div>
          </article>

          <!-- VIA FERRATA -->
          <article class="card tap-card" data-toggle-card>
            <div class="card-head">
              <h3 class="card-title">ВЪЖЕТА / ВИА ФЕРАТА – ТЕОРИЯ</h3>
              <span class="chip chip-blue">теория</span>
              <span class="chip chip-amber">терен</span>
            </div>
            <div class="card-body">Работа с осигурителни въжета и осигуряване на Виа Ферата (теория + терен).</div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="460">460 BGN</span></div>
                <div class="muted">петдневен модул</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-pointer select-none">
                <input type="checkbox" class="module cb accent-green-600 scale-125" data-name="ВЪЖЕТА / ВИА ФЕРАТА – ТЕОРИЯ" data-bgn="460">
                <span class="text-sm font-medium">Избирам</span>
              </label>
            </div>
          </article>

          <!-- ORGANISING (mandatory) -->
          <article class="card tap-card">
            <div class="card-head">
              <h3 class="card-title">ОРГАНИЗИРАНЕ НА МЕРОПРИЯТИЯ</h3>
              <div class="flex gap-1">
                <span class="chip chip-green">онлайн</span>
                <span class="chip chip-blue">теория</span>
                <span class="chip chip-red">задължителен</span>
              </div>
            </div>
            <div class="card-body">Онлайн + теория и практика: 1 ден, 4 часа обучение. Планиране, документиране, логистика.</div>
            <div class="card-foot">
              <div>
                <div class="price-xl"><span class="price" data-bgn="300">300 BGN</span></div>
                <div class="muted">еднодневен модул (4 ч)</div>
              </div>
              <label class="inline-flex items-center tap-area cursor-not-allowed select-none">
                <input type="checkbox" class="module cb mandatory accent-green-600 scale-125"
                       data-name="ОРГАНИЗИРАНЕ НА МЕРОПРИЯТИЯ"
                       data-bgn="300" checked disabled>
                <span class="text-sm font-medium opacity-60">Включен</span>
              </label>
            </div>
          </article>

        </div>
      </section>

      <!-- RIGHT: SUMMARY + FORM -->
      <aside>
        <div class="lg:sticky lg:top-6 space-y-6">
          <!-- SUMMARY -->
          <div class="card">
            <div class="card-head">
              <h4 class="card-title">Обобщение</h4>
              <span class="chip">BGN/EUR</span>
            </div>
            <div class="card-body">
              <div class="flex items-center justify-between text-sm mb-2">
                <span class="muted">Избрани модули: <strong id="selectedCount">0</strong></span>
                <span class="muted">Застраховка: <strong id="needIns">не</strong></span>
              </div>
              <div class="progress mb-3" aria-hidden="true"><span id="selProgress"></span></div>
              <ul id="summaryList" class="space-y-2 text-sm"></ul>
              <div class="mt-3 border-t pt-3 flex items-center justify-between">
                <span class="muted">Междинна сума</span>
                <span id="subtotal" class="font-bold">0 BGN</span>
              </div>
              <div class="mt-1 flex items-center justify-between">
                <span class="muted">Такса кандидатстване</span>
                <span id="fee">0</span>
              </div>
              <div class="mt-3 border-t pt-3 flex items-center justify-between">
                <span class="text-sm font-semibold">Крайна цена</span>
                <span id="grandTotal" class="text-2xl font-extrabold">0 BGN</span>
              </div>
              <p class="muted mt-2">Курс: 1 EUR = 1.95583 BGN.</p>
            </div>
          </div>

          <!-- FORM -->
          <form id="applyForm" action="https://formsubmit.co/uzunov.ange@gmail.com" method="POST" enctype="multipart/form-data" class="card" novalidate>
            <div class="card-head">
              <h4 class="card-title">Заявка</h4>
            </div>
            <div class="card-body">
              <!-- FormSubmit -->
              <input type="hidden" name="_subject" value="Нова заявка – Програма за Планински водачи">
              <input type="hidden" name="_captcha" value="false">
              <input type="hidden" name="_template" value="table">
              <input type="hidden" name="_next" value="https://turizam123.github.io/uzunov/tmap_home.html" />
              <input type="hidden" name="_autoresponse" value="Благодарим за заявката! При одобрение ще се свържем за насрочване на входен изпит. За включване в изпита се заплаща такса кандидатстване 370 лв. / 189.18 EUR.">

              <!-- Hidden fields -->
              <input type="hidden" name="Избрани модули" id="chosenModulesField" value="">
              <input type="hidden" name="Валута" id="currencyField" value="BGN">
              <input type="hidden" name="Такса кандидатстване" id="appFeeField" value="370 BGN">
              <input type="hidden" name="Процедура" value="При одобрение ще се свържем за насрочване на входен изпит. За включване в изпита се заплаща такса кандидатстване 370 лв. / 189.18 EUR.">
              <input type="hidden" name="Тест обща култура – резултат" id="quizScoreField" value="">
              <input type="hidden" name="Тест обща култура – отговори" id="quizAnswersField" value="">

              <label class="block mb-3">
                <span class="text-sm font-medium">Име и фамилия <span class="text-red-600">*</span></span>
                <input required name="Име" type="text" autocomplete="name" class="mt-1 w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="напр. Иван Петров" />
              </label>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-sm font-medium">Имейл <span class="text-red-600">*</span></span>
                  <input required name="Имейл" type="email" inputmode="email" autocomplete="email" class="mt-1 w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="name@example.com" />
                </label>
                <label class="block">
                  <span class="text-sm font-medium">Телефон <span class="text-red-600">*</span></span>
                  <input required name="Телефон" type="tel" inputmode="tel" autocomplete="tel" class="mt-1 w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="+359 ..." />
                </label>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">
                <label class="block">
                  <span class="text-sm font-medium">Опит в планината</span>
                  <select name="Опит" class="mt-1 w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option>Начинаещ</option>
                    <option>Средно напреднал</option>
                    <option>Напреднал</option>
                  </select>
                </label>
                <label class="block">
                  <span class="text-sm font-medium">Тип заявка</span>
                  <select name="Тип заявка" class="mt-1 w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option>Лично</option>
                    <option>От организатор</option>
                  </select>
                </label>
              </div>

              <!-- Insurance (conditional) -->
              <div id="insuranceWrap" class="hidden mt-4 rounded-xl border p-4 bg-green-50">
                <p class="text-sm font-semibold text-green-800">Застраховка за планина</p>
                <p class="text-sm text-green-700 mt-1">За модулите „на терен“ е необходима валидна застраховка.</p>
                <div class="mt-3 grid sm:grid-cols-2 gap-4">
                  <label class="inline-flex items-center gap-2 select-none">
                    <input type="checkbox" id="hasInsurance" class="accent-green-600">
                    <span class="text-sm">Имам валидна застраховка</span>
                  </label>
                  <label class="block">
                    <span class="text-sm">Качване на полица (PDF/JPG, по избор)</span>
                    <input name="Застраховка файл" type="file" accept=".pdf,.jpg,.jpeg,.png" class="mt-1 w-full rounded-xl border px-3 py-2" />
                  </label>
                </div>
              </div>

              <!-- Такса кандидатстване -->
              <div class="mt-4 rounded-xl border border-amber-200 bg-amber-50 p-4 text-amber-900">
                <p class="text-sm">При одобрение ще се свържем за насрочване на входен изпит. За включване в изпита се заплаща
                  <strong>такса кандидатстване 370 лв. / 189.18 EUR</strong>.
                </p>
              </div>
              <div class="mt-3 text-sm flex items-start gap-2">
                <input type="checkbox" required class="mt-1 accent-green-600">
                <span>Потвърждавам, че приемам заплащането на таксата кандидатстване 370 лв. / 189.18 EUR при включване във входния изпит.</span>
              </div>

              <!-- Кратък тест – ЗАДЪЛЖИТЕЛЕН -->
              <div class="mt-4 rounded-xl border bg-white p-4">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <p class="text-sm font-semibold">Кратък тест по обща култура <span class="text-red-600">*</span></p>
                    <p class="text-xs text-slate-600 mt-1">Базови знания за туризма и началото му в България.</p>
                  </div>
                  <button id="openQuizBtn" type="button" class="btn btn-primary ripple">Попълни тест</button>
                </div>
                <p id="quizBadge" class="hidden mt-3 inline-flex items-center gap-2 text-xs font-semibold text-green-700 bg-green-50 border border-green-200 rounded-full px-2 py-1">
                  ✅ Тестът е попълнен <span id="quizScorePreview" class="ml-1"></span>
                </p>
              </div>

              <label class="block mt-4">
                <span class="text-sm font-medium">Допълнителни бележки</span>
                <textarea name="Бележки" rows="3" class="mt-1 w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Специфични нужди, дати, въпроси..."></textarea>
              </label>

              <div class="mt-5 text-xs text-slate-600 flex items-start gap-2">
                <input type="checkbox" required class="mt-1 accent-green-600">
                <span>С изпращането приемам <a href="https://turistibg.weebly.com/10551056104010421048105110401.html" target="_blank" rel="noopener" class="underline decoration-dotted text-green-700">Общите условия</a>.</span>
              </div>
            </div>
            <div class="card-foot">
              <button type="submit" class="btn btn-primary w-full ripple" id="submitBtn">
                <span class="inline-flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M5 12h14M12 5l7 7-7 7"/></svg>
                  Изпрати заявката
                </span>
              </button>
            </div>
          </form>
        </div>
      </aside>
    </div>
  </main>

  <!-- Sticky mobile summary -->
  <div class="lg:hidden fixed bottom-0 inset-x-0 px-4 z-40 pb-4 safe-bottom">
    <div class="bg-white/90 backdrop-blur rounded-2xl shadow-lg border flex items-center justify-between px-4 py-3">
      <div>
        <div class="text-xs text-slate-500">Крайна цена</div>
        <div id="mobileTotal" class="text-xl font-extrabold">0 BGN</div>
      </div>
      <a href="#applyForm" class="btn btn-primary ripple">Попълни заявка</a>
    </div>
  </div>

  <!-- QUIZ MODAL -->
  <div id="quizModal" class="fixed inset-0 z-[60] hidden" aria-modal="true" role="dialog" aria-labelledby="quizTitle">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
    <div class="relative mx-auto mt-10 mb-10 max-w-3xl px-4">
      <div class="card">
        <div class="card-head">
          <h3 class="card-title" id="quizTitle">Кратък тест по обща култура</h3>
          <div class="flex items-center gap-2">
            <span id="quizProgress" class="text-xs font-semibold text-slate-600 hidden">0/6</span>
            <button id="closeQuizBtn" type="button" class="btn" aria-label="Затвори">✕</button>
          </div>
        </div>
        <form id="quizForm">
          <div class="card-body space-y-5 text-sm scroll-y-invisible max-h-[70vh]">
            <fieldset>
              <legend class="font-semibold">1) Кой е смятан за „баща“ на организирания туризъм в България?</legend>
              <div class="mt-2 space-y-2">
                <label class="flex items-center gap-2"><input type="radio" name="q1" value="Алеко Константинов" class="accent-green-600" required> Алеко Константинов</label>
                <label class="flex items-center gap-2"><input type="radio" name="q1" value="Иван Вазов" class="accent-green-600"> Иван Вазов</label>
                <label class="flex items-center gap-2"><input type="radio" name="q1" value="Христо Ботев" class="accent-green-600"> Христо Ботев</label>
              </div>
            </fieldset>

            <fieldset>
              <legend class="font-semibold">2) Масовото изкачване на Черни връх, считано за начало на организирания туризъм у нас, е през:</legend>
              <div class="mt-2 space-y-2">
                <label class="flex items-center gap-2"><input type="radio" name="q2" value="1895" class="accent-green-600" required> 1895 г.</label>
                <label class="flex items-center gap-2"><input type="radio" name="q2" value="1878" class="accent-green-600"> 1878 г.</label>
                <label class="flex items-center gap-2"><input type="radio" name="q2" value="1912" class="accent-green-600"> 1912 г.</label>
              </div>
            </fieldset>

            <fieldset>
              <legend class="font-semibold">3) Най-високият връх в България е:</legend>
              <div class="mt-2 space-y-2">
                <label class="flex items-center gap-2"><input type="radio" name="q3" value="Мусала" class="accent-green-600" required> Мусала </label>
                <label class="flex items-center gap-2"><input type="radio" name="q3" value="Ботев" class="accent-green-600"> Ботев</label>
                <label class="flex items-center gap-2"><input type="radio" name="q3" value="Вихрен" class="accent-green-600"> Вихрен</label>
              </div>
            </fieldset>

            <fieldset>
              <legend class="font-semibold">4) Кой от следните е <u>национален парк</u> в България?</legend>
              <div class="mt-2 space-y-2">
                <label class="flex items-center gap-2"><input type="radio" name="q4" value="Рила" class="accent-green-600" required> Рила</label>
                <label class="flex items-center gap-2"><input type="radio" name="q4" value="Витоша" class="accent-green-600"> Витоша</label>
                <label class="flex items-center gap-2"><input type="radio" name="q4" value="Сините камъни" class="accent-green-600"> Сините камъни</label>
              </div>
            </fieldset>

            <fieldset>
              <legend class="font-semibold">5) Стандартната маркировка за основни туристически маршрути у нас е:</legend>
              <div class="mt-2 space-y-2">
                <label class="flex items-center gap-2"><input type="radio" name="q5" value="бяло-червено-бяло" class="accent-green-600" required> бяло–червено–бяло</label>
                <label class="flex items-center gap-2"><input type="radio" name="q5" value="синьо-жълто-синьо" class="accent-green-600"> синьо–жълто–синьо</label>
                <label class="flex items-center gap-2"><input type="radio" name="q5" value="черно-бяло-черно" class="accent-green-600"> черно–бяло–черно</label>
              </div>
            </fieldset>

            <fieldset>
              <legend class="font-semibold">6) Кое <u>не</u> е принцип на Leave No Trace?</legend>
              <div class="mt-2 space-y-2">
                <label class="flex items-center gap-2"><input type="radio" name="q6" value="Остави следи за следващите" class="accent-green-600" required> „Остави следи за следващите“</label>
                <label class="flex items-center gap-2"><input type="radio" name="q6" value="Планирай предварително" class="accent-green-600"> Планирай предварително</label>
                <label class="flex items-center gap-2"><input type="radio" name="q6" value="Не оставяй отпадъци" class="accent-green-600"> Не оставяй отпадъци</label>
              </div>
            </fieldset>

            <p class="text-xs text-slate-500">* Тестът е задължителен. Резултатите се изпращат заедно със заявката.</p>
          </div>
          <div class="card-foot">
            <button type="button" id="cancelQuizBtn" class="btn">Откажи</button>
            <button type="submit" class="btn btn-primary ripple">Изпрати теста</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">
    <span id="toastText">Съобщение</span>
  </div>

  <script>
    /* ============ Core numbers & helpers ============ */
    const EUR_RATE = 1.95583;
    const APPLICATION_FEE_BGN = 370;
    let currency = localStorage.getItem('currency') || 'BGN';
    const fmt = (bgn) => currency === 'BGN' ? `${bgn.toFixed(0)} BGN` : `${(bgn / EUR_RATE).toFixed(2)} EUR`;

    /* ============ UI helpers ============ */
    function showToast(text, type='info'){  // type: success | warn | error
      const t = document.getElementById('toast');
      const txt = document.getElementById('toastText');
      t.classList.remove('toast--success','toast--warn','toast--error');
      if(type==='success') t.classList.add('toast--success');
      if(type==='warn') t.classList.add('toast--warn');
      if(type==='error') t.classList.add('toast--error');
      txt.textContent = text;
      t.classList.add('toast--show');
      setTimeout(()=>t.classList.remove('toast--show'), 2800);
    }

    // Ripple effect
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.ripple');
      if(!btn) return;
      const circle = document.createElement('span');
      const diameter = Math.max(btn.clientWidth, btn.clientHeight);
      const rect = btn.getBoundingClientRect();
      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${e.clientX - rect.left - diameter/2}px`;
      circle.style.top = `${e.clientY - rect.top - diameter/2}px`;
      circle.style.position='absolute'; circle.style.borderRadius='50%';
      circle.style.background='rgba(255,255,255,.35)';
      circle.style.transform='scale(0)'; circle.style.animation='ripple .6s ease-out';
      circle.style.pointerEvents='none';
      btn.style.overflow='hidden';
      btn.appendChild(circle);
      circle.addEventListener('animationend',()=>circle.remove());
    });
    const style = document.createElement('style');
    style.textContent = '@keyframes ripple{to{transform:scale(3);opacity:0}}';
    document.head.appendChild(style);

    /* ============ Pricing & summary ============ */
    function updatePrices(){
      document.querySelectorAll('.price').forEach(el => {
        const bgn = parseFloat(el.dataset.bgn);
        el.textContent = fmt(bgn);
      });
      updateSummary();
    }

    function updateSummary(){
      const checked = [...document.querySelectorAll('.module:checked')];
      const list = document.getElementById('summaryList');
      list.innerHTML = '';
      let subtotal = 0; let terrain = false;

      checked.forEach(cb => {
        const name = cb.dataset.name; const bgn = parseFloat(cb.dataset.bgn);
        subtotal += bgn;
        if(cb.classList.contains('need-insurance')) terrain = true;
        const li = document.createElement('li');
        li.className = 'flex items-center justify-between';
        li.innerHTML = `<span>${name}</span><span class='font-semibold'>${fmt(bgn)}</span>`;
        list.appendChild(li);
      });

      const feeBGN = APPLICATION_FEE_BGN;
      const feeRow = document.createElement('li');
      feeRow.className = 'flex items-center justify-between border-t pt-2 mt-2';
      feeRow.innerHTML = `<span>Такса кандидатстване</span><span class='font-semibold'>${fmt(feeBGN)}</span>`;
      list.appendChild(feeRow);

      const total = subtotal + feeBGN;
      document.getElementById('subtotal').textContent = fmt(subtotal);
      document.getElementById('fee').textContent = fmt(feeBGN);
      document.getElementById('grandTotal').textContent = fmt(total);
      document.getElementById('mobileTotal').textContent = fmt(total);
      document.getElementById('insuranceWrap').classList.toggle('hidden', !terrain);

      const chosen = checked.map(cb => `${cb.dataset.name} (${fmt(parseFloat(cb.dataset.bgn))})`);
      document.getElementById('chosenModulesField').value = chosen.join(', ');
      document.getElementById('appFeeField').value = fmt(feeBGN);

      // UX: counter + progress
      const count = checked.length;
      document.getElementById('selectedCount').textContent = count;
      document.getElementById('needIns').textContent = terrain ? 'да' : 'не';
      const progress = Math.min((count/6)*100, 100); // произволна нормализация
      document.getElementById('selProgress').style.width = progress + '%';

      localStorage.setItem('selectedModules', JSON.stringify(checked.map(cb => cb.dataset.name)));
    }

    // Toggle currency
    const btnBGN = document.getElementById('btnBGN');
    const btnEUR = document.getElementById('btnEUR');
    function setCurrency(cur){
      currency = cur; localStorage.setItem('currency', cur);
      document.getElementById('currencyField').value = cur;
      const isBGN = cur === 'BGN';
      btnBGN.setAttribute('aria-pressed', isBGN);
      btnEUR.setAttribute('aria-pressed', !isBGN);
      btnBGN.classList.toggle('bg-green-600', isBGN);
      btnBGN.classList.toggle('text-white', isBGN);
      btnEUR.classList.toggle('bg-green-600', !isBGN);
      btnEUR.classList.toggle('text-white', !isBGN);
      updatePrices();
      showToast(`Показване на цени в ${cur}`, 'success');
    }
    btnBGN.addEventListener('click', () => setCurrency('BGN'));
    btnEUR.addEventListener('click', () => setCurrency('EUR'));

    // Tap whole card to toggle (само за чекбокси, които НЕ са disabled)
    document.querySelectorAll('[data-toggle-card]').forEach(card=>{
      card.addEventListener('click', (e)=>{
        const cb = card.querySelector('input[type="checkbox"].module:not(:disabled)');
        if(!cb) return;
        // игнорираме ако самият label/checkbox е кликнат
        if(e.target.tagName === 'INPUT' || e.target.closest('label')) return;
        cb.checked = !cb.checked;
        updateSummary();
      });
    });

    // Module change
    document.querySelectorAll('.module').forEach(cb => cb.addEventListener('change', ()=>{
      updateSummary();
      if(cb.checked) showToast(`Добави: ${cb.dataset.name}`, 'success');
      else showToast(`Премахна: ${cb.dataset.name}`, 'warn');
    }));

    // Submit guard: modules + season + quiz
    document.getElementById('applyForm').addEventListener('submit', (e) => {
      const any = document.querySelector('.module:checked');
      const seasonPicked = document.querySelector('.required-season:checked');
      if(!any){
        e.preventDefault(); showToast('Моля, избери поне един модул.', 'error');
        return;
      }
      if(!seasonPicked){
        e.preventDefault(); showToast('Избери поне един сезонен модул: „Лято“ или „Зима“.', 'error');
        return;
      }
      if(!document.getElementById('quizScoreField').value.trim()){
        e.preventDefault(); showToast('Попълни задължителния тест по обща култура.', 'error');
        openQuiz();
        return;
      }
      // loading state
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.style.opacity = .85;
      submitBtn.innerHTML = `<span class="inline-flex items-center gap-2">
        <svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="9" stroke-width="2" opacity=".35"/><path d="M21 12a9 9 0 0 1-9 9" stroke-width="2"/></svg>
        Изпращане...
      </span>`;
    });

    // Restore on load
    window.addEventListener('DOMContentLoaded', () => {
      setCurrency(currency);
      try{
        const stored = JSON.parse(localStorage.getItem('selectedModules')||'[]');
        if(Array.isArray(stored) && stored.length){
          document.querySelectorAll('.module:not(.mandatory)').forEach(cb => {
            cb.checked = stored.includes(cb.dataset.name);
          });
        }
      }catch(err){}
      updatePrices();
    });

    /* ============ QUIZ LOGIC ============ */
    const quizModal = document.getElementById('quizModal');
    const openQuizBtn = document.getElementById('openQuizBtn');
    const closeQuizBtn = document.getElementById('closeQuizBtn');
    const cancelQuizBtn = document.getElementById('cancelQuizBtn');
    const quizForm = document.getElementById('quizForm');
    const quizBadge = document.getElementById('quizBadge');
    const quizScorePreview = document.getElementById('quizScorePreview');
    const quizScoreField = document.getElementById('quizScoreField');
    const quizAnswersField = document.getElementById('quizAnswersField');
    const quizProgress = document.getElementById('quizProgress');

    function openQuiz(){ quizModal.classList.remove('hidden'); document.body.classList.add('overflow-hidden'); }
    function closeQuiz(){ quizModal.classList.add('hidden'); document.body.classList.remove('overflow-hidden'); }

    openQuizBtn?.addEventListener('click', openQuiz);
    closeQuizBtn?.addEventListener('click', closeQuiz);
    cancelQuizBtn?.addEventListener('click', closeQuiz);
    quizModal.addEventListener('click', (e)=>{ if(e.target === quizModal) closeQuiz(); });

    const quizKey = { q1:'Алеко Константинов', q2:'1895', q3:'Мусала', q4:'Рила', q5:'бяло-червено-бяло', q6:'Остави следи за следващите' };
    const allQuestions = ['q1','q2','q3','q4','q5','q6'];

    function updateQuizProgress(){
      const answered = allQuestions.reduce((acc,q)=> acc + (quizForm.querySelector(`input[name="${q}"]:checked`) ? 1 : 0), 0);
      quizProgress.textContent = `${answered}/${allQuestions.length}`;
      quizProgress.classList.toggle('hidden', answered === 0);
    }
    quizForm.addEventListener('change', updateQuizProgress);

    quizForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const formData = new FormData(quizForm);
      const answers = {};
      let answeredAll = true;
      allQuestions.forEach(q=>{
        const v = formData.get(q);
        if(!v) answeredAll = false;
        answers[q] = v || '';
      });
      if(!answeredAll){
        showToast('Моля, отговори на всички въпроси.', 'error');
        return;
      }
      let score = 0;
      allQuestions.forEach(q=>{ if(answers[q] === quizKey[q]) score++; });

      const summary = [
        `Q1: ${answers.q1}`, `Q2: ${answers.q2}`, `Q3: ${answers.q3}`,
        `Q4: ${answers.q4}`, `Q5: ${answers.q5}`, `Q6: ${answers.q6}`
      ].join(' | ');

      quizScoreField.value = `${score} / ${allQuestions.length}`;
      quizAnswersField.value = summary;

      quizBadge.classList.remove('hidden');
      quizScorePreview.textContent = `(${score} / ${allQuestions.length})`;
      closeQuiz();
      showToast('Тестът е изпратен успешно!', 'success');

      localStorage.setItem('quiz_result', JSON.stringify({score, answers}));
    });

    // Restore quiz state
    window.addEventListener('DOMContentLoaded', ()=>{
      try{
        const storedQuiz = JSON.parse(localStorage.getItem('quiz_result') || 'null');
        if(storedQuiz && typeof storedQuiz.score === 'number'){
          quizBadge.classList.remove('hidden');
          quizScorePreview.textContent = `(${storedQuiz.score} / 6)`;
          quizScoreField.value = `${storedQuiz.score} / 6`;
          const a = storedQuiz.answers || {};
          quizAnswersField.value = `Q1: ${a.q1||''} | Q2: ${a.q2||''} | Q3: ${a.q3||''} | Q4: ${a.q4||''} | Q5: ${a.q5||''} | Q6: ${a.q6||''}`;
          updateQuizProgress();
        }
      }catch(_e){}
    });
  </script>
</body>
</html>
