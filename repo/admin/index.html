<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Админ – Табло</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-slate-50 text-slate-900">

<!-- ================= CONFIG ================= -->
<script src="../config.js"></script>

<!-- ================= NAV CONTAINER ================= -->
<nav id="appNav"
     class="bg-white border-b px-6 py-3 flex flex-wrap gap-2 items-center">
</nav>

<!-- ================= ADMIN NAV + GUARD ================= -->
<script src="./_admin-nav.js"></script>

<!-- ================= PAGE ================= -->
<main class="mx-auto max-w-7xl px-4 py-8 space-y-6">

  <!-- HEADER -->
  <section class="rounded-2xl border bg-white p-6 shadow-sm">
    <h1 class="text-2xl font-extrabold">Админ табло</h1>

    <p class="mt-2 text-slate-600 text-sm">
      Ако виждаш това и менюто горе – guard + навигацията работят коректно.
    </p>
  </section>

  <!-- QUICK STATS -->
  <section class="grid md:grid-cols-4 gap-4">

    <div class="rounded-xl border bg-white p-4 shadow-sm">
      <div class="text-sm text-slate-500">Модули</div>
      <div id="statModules" class="text-2xl font-extrabold">0</div>
    </div>

    <div class="rounded-xl border bg-white p-4 shadow-sm">
      <div class="text-sm text-slate-500">Теми</div>
      <div id="statLessons" class="text-2xl font-extrabold">0</div>
    </div>

    <div class="rounded-xl border bg-white p-4 shadow-sm">
      <div class="text-sm text-slate-500">Изпити</div>
      <div id="statExams" class="text-2xl font-extrabold">0</div>
    </div>

    <div class="rounded-xl border bg-white p-4 shadow-sm">
      <div class="text-sm text-slate-500">Резултати</div>
      <div id="statResults" class="text-2xl font-extrabold">0</div>
    </div>

  </section>

</main>

<script>
/* ================= SAFE INIT ================= */

document.addEventListener("DOMContentLoaded", () => {

  if (!window.__sb_admin) {
    console.error("Admin client missing");
    return;
  }

  const sb = window.__sb_admin;

  const statModules = document.getElementById("statModules");
  const statLessons = document.getElementById("statLessons");
  const statExams = document.getElementById("statExams");
  const statResults = document.getElementById("statResults");

  /* ================= LOAD STATS (RLS SAFE) ================= */

  async function loadStats(){

    try {

      const modulesReq = await sb.from("modules").select("id");
      const lessonsReq = await sb.from("lessons").select("id");
      const examsReq = await sb.from("exams").select("id");
      const resultsReq = await sb.from("exam_results").select("id");

      statModules.textContent = modulesReq.data?.length || 0;
      statLessons.textContent = lessonsReq.data?.length || 0;
      statExams.textContent = examsReq.data?.length || 0;
      statResults.textContent = resultsReq.data?.length || 0;

    } catch (err) {
      console.error(err);
    }

  }

  loadStats();

});
</script>

</body>
</html>
